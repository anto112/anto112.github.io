<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>

<link href='https://fonts.loli.net/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext' rel='stylesheet' type='text/css' /><style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color:#ffffff; --text-color:#333333; --select-text-bg-color:#B5D6FC; --select-text-font-color:auto; --monospace:"Lucida Console",Consolas,"Courier",monospace; --title-bar-height:20px; }
.mac-os-11 { --title-bar-height:28px; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
body { margin: 0px; padding: 0px; height: auto; inset: 0px; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; tab-size: 4; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; overflow-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 36px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
.typora-export .task-list-item input { pointer-events: none; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
#write li > figure:last-child { margin-bottom: 0.5rem; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; image-orientation: from-image; }
button, input, select, textarea { color: inherit; font: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
p { line-height: inherit; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 4; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right: 0px; background-color: inherit; }
.CodeMirror-linenumber { user-select: none; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-fences-adv-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li blockquote { margin: 1rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; font-variant-ligatures: no-common-ligatures; }
  #write { margin-top: 0px; padding-top: 0px; border-color: transparent !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  .typora-export #write { break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  .is-mac table { break-inside: avoid; }
  .typora-export-show-outline .typora-export-sidebar { display: none; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
#write.first-line-indent p > .md-image:only-child:not(.md-img-error) img { left: -2em; position: relative; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
.MathJax_ref { fill: currentcolor; }
[contenteditable="true"]:active, [contenteditable="true"]:focus, [contenteditable="false"]:active, [contenteditable="false"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.6; font-family: var(--monospace); }
code { text-align: left; vertical-align: initial; }
a.md-print-anchor { white-space: pre !important; border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="flow"] svg, [lang="mermaid"] svg { max-width: 100%; height: auto; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }
mark { background: rgb(255, 255, 0); color: rgb(0, 0, 0); }
.md-html-inline .md-plain, .md-html-inline strong, mark .md-inline-math, mark strong { color: inherit; }
.md-expand mark .md-meta { opacity: 0.3 !important; }
mark .md-meta { color: rgb(0, 0, 0); }
@media print {
  .typora-export h1, .typora-export h2, .typora-export h3, .typora-export h4, .typora-export h5, .typora-export h6 { break-inside: avoid; }
}
.md-diagram-panel .messageText { stroke: none !important; }
.md-diagram-panel .start-state { fill: var(--node-fill); }
.md-diagram-panel .edgeLabel rect { opacity: 1 !important; }
.md-fences.md-fences-math { font-size: 1em; }
.md-fences-advanced:not(.md-focus) { padding: 0px; white-space: nowrap; border: 0px; }
.md-fences-advanced:not(.md-focus) { background: inherit; }
.typora-export-show-outline .typora-export-content { max-width: 1440px; margin: auto; display: flex; flex-direction: row; }
.typora-export-sidebar { width: 300px; font-size: 0.8rem; margin-top: 80px; margin-right: 18px; }
.typora-export-show-outline #write { --webkit-flex:2; flex: 2 1 0%; }
.typora-export-sidebar .outline-content { position: fixed; top: 0px; max-height: 100%; overflow: hidden auto; padding-bottom: 30px; padding-top: 60px; width: 300px; }
@media screen and (max-width: 1024px) {
  .typora-export-sidebar, .typora-export-sidebar .outline-content { width: 240px; }
}
@media screen and (max-width: 800px) {
  .typora-export-sidebar { display: none; }
}
.outline-content li, .outline-content ul { margin-left: 0px; margin-right: 0px; padding-left: 0px; padding-right: 0px; list-style: none; }
.outline-content ul { margin-top: 0px; margin-bottom: 0px; }
.outline-content strong { font-weight: 400; }
.outline-expander { width: 1rem; height: 1.42857rem; position: relative; display: table-cell; vertical-align: middle; cursor: pointer; padding-left: 4px; }
.outline-expander::before { content: ""; position: relative; font-family: Ionicons; display: inline-block; font-size: 8px; vertical-align: middle; }
.outline-item { padding-top: 3px; padding-bottom: 3px; cursor: pointer; }
.outline-expander:hover::before { content: ""; }
.outline-h1 > .outline-item { padding-left: 0px; }
.outline-h2 > .outline-item { padding-left: 1em; }
.outline-h3 > .outline-item { padding-left: 2em; }
.outline-h4 > .outline-item { padding-left: 3em; }
.outline-h5 > .outline-item { padding-left: 4em; }
.outline-h6 > .outline-item { padding-left: 5em; }
.outline-label { cursor: pointer; display: table-cell; vertical-align: middle; text-decoration: none; color: inherit; }
.outline-label:hover { text-decoration: underline; }
.outline-item:hover { border-color: rgb(245, 245, 245); background-color: var(--item-hover-bg-color); }
.outline-item:hover { margin-left: -28px; margin-right: -28px; border-left: 28px solid transparent; border-right: 28px solid transparent; }
.outline-item-single .outline-expander::before, .outline-item-single .outline-expander:hover::before { display: none; }
.outline-item-open > .outline-item > .outline-expander::before { content: ""; }
.outline-children { display: none; }
.info-panel-tab-wrapper { display: none; }
.outline-item-open > .outline-children { display: block; }
.typora-export .outline-item { padding-top: 1px; padding-bottom: 1px; }
.typora-export .outline-item:hover { margin-right: -8px; border-right: 8px solid transparent; }
.typora-export .outline-expander::before { content: "+"; font-family: inherit; top: -1px; }
.typora-export .outline-expander:hover::before, .typora-export .outline-item-open > .outline-item > .outline-expander::before { content: "−"; }
.typora-export-collapse-outline .outline-children { display: none; }
.typora-export-collapse-outline .outline-item-open > .outline-children, .typora-export-no-collapse-outline .outline-children { display: block; }
.typora-export-no-collapse-outline .outline-expander::before { content: "" !important; }
.typora-export-show-outline .outline-item-active > .outline-item .outline-label { font-weight: 700; }
.md-inline-math-container mjx-container { zoom: 0.95; }


.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background: inherit; }
.CodeMirror-scroll { overflow: auto hidden; z-index: 3; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right: 1px solid rgb(221, 221, 221); background: inherit; white-space: nowrap; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background: inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background: inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; outline: 0px; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: auto hidden; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 10px; z-index: 3; overflow-y: hidden; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; background: 0px 0px !important; border: none !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; background: 0px 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; overflow-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; }
.CodeMirror-wrap pre { overflow-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right: 30px solid transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right: none; width: auto; }
.CodeMirror-linebackground { position: absolute; inset: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background: rgba(255, 255, 0, 0.4); }
span.cm-underlined { text-decoration: underline; }
span.cm-strikethrough { text-decoration: line-through; }
.cm-tw-syntaxerror { color: rgb(255, 255, 255); background-color: rgb(153, 0, 0); }
.cm-tw-deleted { text-decoration: line-through; }
.cm-tw-header5 { font-weight: 700; }
.cm-tw-listitem:first-child { padding-left: 10px; }
.cm-tw-box { border-style: solid; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-color: inherit; border-top-width: 0px !important; }
.cm-tw-underline { text-decoration: underline; }
@media print {
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


:root {
    --side-bar-bg-color: #fafafa;
    --control-text-color: #777;
}

@include-when-export url(https://fonts.loli.net/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext);

/* open-sans-regular - latin-ext_latin */
  /* open-sans-italic - latin-ext_latin */
    /* open-sans-700 - latin-ext_latin */
    /* open-sans-700italic - latin-ext_latin */
  html {
    font-size: 16px;
    -webkit-font-smoothing: antialiased;
}

body {
    font-family: "Open Sans","Clear Sans", "Helvetica Neue", Helvetica, Arial, 'Segoe UI Emoji', sans-serif;
    color: rgb(51, 51, 51);
    line-height: 1.6;
}

#write {
    max-width: 860px;
  	margin: 0 auto;
  	padding: 30px;
    padding-bottom: 100px;
}

@media only screen and (min-width: 1400px) {
	#write {
		max-width: 1024px;
	}
}

@media only screen and (min-width: 1800px) {
	#write {
		max-width: 1200px;
	}
}

#write > ul:first-child,
#write > ol:first-child{
    margin-top: 30px;
}

a {
    color: #4183C4;
}
h1,
h2,
h3,
h4,
h5,
h6 {
    position: relative;
    margin-top: 1rem;
    margin-bottom: 1rem;
    font-weight: bold;
    line-height: 1.4;
    cursor: text;
}
h1:hover a.anchor,
h2:hover a.anchor,
h3:hover a.anchor,
h4:hover a.anchor,
h5:hover a.anchor,
h6:hover a.anchor {
    text-decoration: none;
}
h1 tt,
h1 code {
    font-size: inherit;
}
h2 tt,
h2 code {
    font-size: inherit;
}
h3 tt,
h3 code {
    font-size: inherit;
}
h4 tt,
h4 code {
    font-size: inherit;
}
h5 tt,
h5 code {
    font-size: inherit;
}
h6 tt,
h6 code {
    font-size: inherit;
}
h1 {
    font-size: 2.25em;
    line-height: 1.2;
    border-bottom: 1px solid #eee;
}
h2 {
    font-size: 1.75em;
    line-height: 1.225;
    border-bottom: 1px solid #eee;
}

/*@media print {
    .typora-export h1,
    .typora-export h2 {
        border-bottom: none;
        padding-bottom: initial;
    }

    .typora-export h1::after,
    .typora-export h2::after {
        content: "";
        display: block;
        height: 100px;
        margin-top: -96px;
        border-top: 1px solid #eee;
    }
}*/

h3 {
    font-size: 1.5em;
    line-height: 1.43;
}
h4 {
    font-size: 1.25em;
}
h5 {
    font-size: 1em;
}
h6 {
   font-size: 1em;
    color: #777;
}
p,
blockquote,
ul,
ol,
dl,
table{
    margin: 0.8em 0;
}
li>ol,
li>ul {
    margin: 0 0;
}
hr {
    height: 2px;
    padding: 0;
    margin: 16px 0;
    background-color: #e7e7e7;
    border: 0 none;
    overflow: hidden;
    box-sizing: content-box;
}

li p.first {
    display: inline-block;
}
ul,
ol {
    padding-left: 30px;
}
ul:first-child,
ol:first-child {
    margin-top: 0;
}
ul:last-child,
ol:last-child {
    margin-bottom: 0;
}
blockquote {
    border-left: 4px solid #dfe2e5;
    padding: 0 15px;
    color: #777777;
}
blockquote blockquote {
    padding-right: 0;
}
table {
    padding: 0;
    word-break: initial;
}
table tr {
    border: 1px solid #dfe2e5;
    margin: 0;
    padding: 0;
}
table tr:nth-child(2n),
thead {
    background-color: #f8f8f8;
}
table th {
    font-weight: bold;
    border: 1px solid #dfe2e5;
    border-bottom: 0;
    margin: 0;
    padding: 6px 13px;
}
table td {
    border: 1px solid #dfe2e5;
    margin: 0;
    padding: 6px 13px;
}
table th:first-child,
table td:first-child {
    margin-top: 0;
}
table th:last-child,
table td:last-child {
    margin-bottom: 0;
}

.CodeMirror-lines {
    padding-left: 4px;
}

.code-tooltip {
    box-shadow: 0 1px 1px 0 rgba(0,28,36,.3);
    border-top: 1px solid #eef2f2;
}

.md-fences,
code,
tt {
    border: 1px solid #e7eaed;
    background-color: #f8f8f8;
    border-radius: 3px;
    padding: 0;
    padding: 2px 4px 0px 4px;
    font-size: 0.9em;
}

code {
    background-color: #f3f4f4;
    padding: 0 2px 0 2px;
}

.md-fences {
    margin-bottom: 15px;
    margin-top: 15px;
    padding-top: 8px;
    padding-bottom: 6px;
}


.md-task-list-item > input {
  margin-left: -1.3em;
}

@media print {
    html {
        font-size: 13px;
    }
    table,
    pre {
        page-break-inside: avoid;
    }
    pre {
        word-wrap: break-word;
    }
}

.md-fences {
	background-color: #f8f8f8;
}
#write pre.md-meta-block {
	padding: 1rem;
    font-size: 85%;
    line-height: 1.45;
    background-color: #f7f7f7;
    border: 0;
    border-radius: 3px;
    color: #777777;
    margin-top: 0 !important;
}

.mathjax-block>.code-tooltip {
	bottom: .375rem;
}

.md-mathjax-midline {
    background: #fafafa;
}

#write>h3.md-focus:before{
	left: -1.5625rem;
	top: .375rem;
}
#write>h4.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h5.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h6.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
.md-image>.md-meta {
    /*border: 1px solid #ddd;*/
    border-radius: 3px;
    padding: 2px 0px 0px 4px;
    font-size: 0.9em;
    color: inherit;
}

.md-tag {
    color: #a7a7a7;
    opacity: 1;
}

.md-toc { 
    margin-top:20px;
    padding-bottom:20px;
}

.sidebar-tabs {
    border-bottom: none;
}

#typora-quick-open {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
}

#typora-quick-open-item {
    background-color: #FAFAFA;
    border-color: #FEFEFE #e5e5e5 #e5e5e5 #eee;
    border-style: solid;
    border-width: 1px;
}

/** focus mode */
.on-focus-mode blockquote {
    border-left-color: rgba(85, 85, 85, 0.12);
}

header, .context-menu, .megamenu-content, footer{
    font-family: "Segoe UI", "Arial", sans-serif;
}

.file-node-content:hover .file-node-icon,
.file-node-content:hover .file-node-open-state{
    visibility: visible;
}

.mac-seamless-mode #typora-sidebar {
    background-color: #fafafa;
    background-color: var(--side-bar-bg-color);
}

.md-lang {
    color: #b4654d;
}

/*.html-for-mac {
    --item-hover-bg-color: #E6F0FE;
}*/

#md-notification .btn {
    border: 0;
}

.dropdown-menu .divider {
    border-color: #e5e5e5;
    opacity: 0.4;
}

.ty-preferences .window-content {
    background-color: #fafafa;
}

.ty-preferences .nav-group-item.active {
    color: white;
    background: #999;
}

.menu-item-container a.menu-style-btn {
    background-color: #f5f8fa;
    background-image: linear-gradient( 180deg , hsla(0, 0%, 100%, 0.8), hsla(0, 0%, 100%, 0)); 
}

.site-header {
  /* border-bottom: 1px solid #e8e8e8; */
  text-align: center;
  font-size: 32px;
  min-height: 56px;
  color:#e9dede ;
  background-color: #070707;
} 

.wrap {
  max-width: 1000px;
  padding: 0 30px;
  margin: 0 auto;
  zoom: 1;
}

.title-wrap {
  text-align: center;
}


</style><title>Image enhancement</title>
</head>
<body class='typora-export'>
    
    <header class="site-header">
        <div class="wrap title-wrap">
            <!-- modify here for base link -->
            <a href="index.html">Digital Image Processing</a>
        </div>      
    </header>
    
    <div class='typora-export-content'>
<div id='write'  class=''><p><strong><span>Author: Sandipan Dey</span></strong></p><p><span>In this chapter, we will discuss some of the most basic tools in image processing, such as </span><strong><span>mean/median filtering and histogram equalization</span></strong><span>, which are still among the most powerful tools. The objective of image enhancement is to </span><strong><span>improve the quality of an image or make particular features appear more prominent</span></strong><span>. These techniques are more general purpose techniques, and a strong model of the degradation process is not assumed (unlike image restoration). Some examples of image enhancement techniques are </span><strong><span>contrast stretching, smoothing, and sharpening</span></strong><span>. We will describe the basic concepts and implementation of these techniques using Python library functions and using </span><em><em><strong><span>PIL, scikit-image, and scipy ndimage</span></strong></em></em><span> libraries. We will become familiar with simple and still-popular approaches.</span></p><p><span>We will start with </span><strong><span>point-wise intensity transformation</span></strong><span>, and then discuss </span><strong><span>contrast stretching, thresholding, half-toning, and dithering algorithms</span></strong><span>, and the corresponding </span><strong><span>Python library functions</span></strong><span>. Then we will discuss different </span><strong><span>histogram processing techniques</span></strong><span> such as </span><strong><span>histogram equalization</span></strong><span> (both its global and adaptive version) and </span><strong><span>histogram matching</span></strong><span>. Then, a few techniques to </span><strong><span>denoise</span></strong><span> an image will be described. First, a few linear smoothing techniques such as the </span><strong><span>average filter and Gaussian filter</span></strong><span> will be described, followed by relatively more recent </span><strong><span>non-linear noise smoothing techniques</span></strong><span> such as median </span><strong><span>filtering, bilateral filtering, and non-local means filtering</span></strong><span>, along with how to implement them in Python. Finally, different image operations with </span><strong><span>mathematical morphology</span></strong><span> and their applications, along with implementations, will be described.</span></p><p><span>The topics to be covered in this chapter are as follows:</span></p><blockquote><ol start='' ><li><span>Point-wise intensity transformations – pixel transformation</span></li></ol></blockquote><ol start='2' ><li><span>Histogram processing, histogram equalization, histogram matching</span></li><li><span>Linear noise smoothing (mean filter)</span></li><li><span>Non-linear noise smoothing (median filter)</span></li></ol><p><strong><span>Point-wise intensity transformations – pixel transformation</span></strong></p><p>As discussed in the Chapter 1,&nbsp;Getting Started with Image Processing, the point-wise intensity transformation operation applies a transfer function,&nbsp;T,&nbsp;to&nbsp;each pixel,&nbsp;f(x,y), of the input image to generate a corresponding pixel in the output image. The transformation can be expressed as&nbsp;g(x,y) = T(f(x,y)) or, equivalently,&nbsp;s = T(r), where r is the gray-level of a pixel in the&nbsp;input image and s is the transformed gray-level of the same pixel in the output image. It's a memory-less operation, and the output intensity at the location,(x, y), depends only&nbsp;on the input intensity at the same point. Pixels of the same intensity get the same transformation. This does not bring in new information and may cause loss of information, but can improve the visual appearance or make features easier to detect—that is why these transformations are often applied at the pre-processing step in the image processing pipeline. The following screenshot shows the point processing, as well as the mask/kernel processing (for spatial filters that consider neighborhood pixels also for transformation, as we have already seen):</p><p><img src="images/ch-4-1.png" referrerpolicy="no-referrer" alt="png"></p><p>&nbsp;</p><p>Some popular intensity transformations are the following:</p><ol start='' ><li><span>Image negatives</span></li><li><span>Color space transformation</span></li><li><span>Log transform</span></li><li><span>Power-law transformation</span></li><li><span>Contrast stretching</span></li><li><span>Scalar quantization</span></li><li><span>Thresholding</span></li></ol><p><span>We already discussed a few of them in the Chapter 1, Getting Started with Image Processing. Here, we will start with log transformation on a colored RGB image using PIL, and then discuss a few transformations that we have not yet covered.</span></p><p><strong><span>Import libraries</span></strong></p><p>As usual, we will start by importing all the required modules from the relevant&nbsp;Python libraries</p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">%</span><span class="cm-variable">matplotlib</span> <span class="cm-variable">inline</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">numpy</span> <span class="cm-keyword">as</span> <span class="cm-variable">np</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">skimage</span> <span class="cm-keyword">import</span> <span class="cm-variable">data</span>, <span class="cm-variable">img_as_float</span>, <span class="cm-variable">img_as_ubyte</span>, <span class="cm-variable">exposure</span>, <span class="cm-variable">io</span>, <span class="cm-variable">color</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">skimage</span>.<span class="cm-property">io</span> <span class="cm-keyword">import</span> <span class="cm-variable">imread</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">skimage</span>.<span class="cm-property">exposure</span> <span class="cm-keyword">import</span> <span class="cm-variable">cumulative_distribution</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">skimage</span>.<span class="cm-property">restoration</span> <span class="cm-keyword">import</span> <span class="cm-variable">denoise_bilateral</span>, <span class="cm-variable">denoise_nl_means</span>, <span class="cm-variable">estimate_sigma</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">skimage</span>.<span class="cm-property">measure</span> <span class="cm-keyword">import</span> <span class="cm-variable">compare_psnr</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">skimage</span>.<span class="cm-property">util</span> <span class="cm-keyword">import</span> <span class="cm-variable">random_noise</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">skimage</span>.<span class="cm-property">color</span> <span class="cm-keyword">import</span> <span class="cm-variable">rgb2gray</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">PIL</span> <span class="cm-keyword">import</span> <span class="cm-variable">Image</span>, <span class="cm-variable">ImageEnhance</span>, <span class="cm-variable">ImageFilter</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">scipy</span> <span class="cm-keyword">import</span> <span class="cm-variable">ndimage</span>, <span class="cm-variable">misc</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">matplotlib</span>.<span class="cm-property">pylab</span> <span class="cm-keyword">as</span> <span class="cm-variable">pylab</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 299px;"></div><div class="CodeMirror-gutters" style="display: none; height: 299px;"></div></div></div></pre><h3 id='log-transform'><span>Log transform</span></h3><p><span>The log transformation is very useful when we need to compress or stretch a certain range of gray-levels in an image; for example, in order to display the Fourier spectrum (where the DC component value is much higher than the others, so that without the log transform the other frequency components almost always cannot even be seen). The point transformation function for a log transform is of the general form,, where c is a constant.</span></p><p><span>Let&#39;s implement the histogram for the color channels of the input image:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">def</span> <span class="cm-def">plot_image</span>(<span class="cm-variable">image</span>, <span class="cm-variable">title</span>=<span class="cm-string">''</span>):</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">pylab</span>.<span class="cm-property">title</span>(<span class="cm-variable">title</span>, <span class="cm-variable">size</span>=<span class="cm-number">20</span>), <span class="cm-variable">pylab</span>.<span class="cm-property">imshow</span>(<span class="cm-variable">image</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">pylab</span>.<span class="cm-property">axis</span>(<span class="cm-string">'off'</span>) <span class="cm-comment"># comment this line if you want axis ticks</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">def</span> <span class="cm-def">plot_hist</span>(<span class="cm-variable">r</span>, <span class="cm-variable">g</span>, <span class="cm-variable">b</span>, <span class="cm-variable">title</span>=<span class="cm-string">''</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">r</span>, <span class="cm-variable">g</span>, <span class="cm-variable">b</span> = <span class="cm-variable">img_as_ubyte</span>(<span class="cm-variable">r</span>), <span class="cm-variable">img_as_ubyte</span>(<span class="cm-variable">g</span>), <span class="cm-variable">img_as_ubyte</span>(<span class="cm-variable">b</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">pylab</span>.<span class="cm-property">hist</span>(<span class="cm-variable">np</span>.<span class="cm-property">array</span>(<span class="cm-variable">r</span>).<span class="cm-property">ravel</span>(), <span class="cm-variable">bins</span>=<span class="cm-number">256</span>, <span class="cm-builtin">range</span>=(<span class="cm-number">0</span>, <span class="cm-number">256</span>), <span class="cm-variable">color</span>=<span class="cm-string">'r'</span>, <span class="cm-variable">alpha</span>=<span class="cm-number">0.5</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">pylab</span>.<span class="cm-property">hist</span>(<span class="cm-variable">np</span>.<span class="cm-property">array</span>(<span class="cm-variable">g</span>).<span class="cm-property">ravel</span>(), <span class="cm-variable">bins</span>=<span class="cm-number">256</span>, <span class="cm-builtin">range</span>=(<span class="cm-number">0</span>, <span class="cm-number">256</span>), <span class="cm-variable">color</span>=<span class="cm-string">'g'</span>, <span class="cm-variable">alpha</span>=<span class="cm-number">0.5</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">pylab</span>.<span class="cm-property">hist</span>(<span class="cm-variable">np</span>.<span class="cm-property">array</span>(<span class="cm-variable">b</span>).<span class="cm-property">ravel</span>(), <span class="cm-variable">bins</span>=<span class="cm-number">256</span>, <span class="cm-builtin">range</span>=(<span class="cm-number">0</span>, <span class="cm-number">256</span>), <span class="cm-variable">color</span>=<span class="cm-string">'b'</span>, <span class="cm-variable">alpha</span>=<span class="cm-number">0.5</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">pylab</span>.<span class="cm-property">xlabel</span>(<span class="cm-string">'pixel value'</span>, <span class="cm-variable">size</span>=<span class="cm-number">20</span>), <span class="cm-variable">pylab</span>.<span class="cm-property">ylabel</span>(<span class="cm-string">'frequency'</span>, <span class="cm-variable">size</span>=<span class="cm-number">20</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">pylab</span>.<span class="cm-property">title</span>(<span class="cm-variable">title</span>, <span class="cm-variable">size</span>=<span class="cm-number">20</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">im</span> = <span class="cm-variable">Image</span>.<span class="cm-property">open</span>(<span class="cm-string">"../images/parrot.png"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">im_r</span>, <span class="cm-variable">im_g</span>, <span class="cm-variable">im_b</span> = <span class="cm-variable">im</span>.<span class="cm-property">split</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">style</span>.<span class="cm-property">use</span>(<span class="cm-string">'ggplot'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">figure</span>(<span class="cm-variable">figsize</span>=(<span class="cm-number">15</span>,<span class="cm-number">5</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">subplot</span>(<span class="cm-number">121</span>), <span class="cm-variable">plot_image</span>(<span class="cm-variable">im</span>, <span class="cm-string">'original image'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">subplot</span>(<span class="cm-number">122</span>), <span class="cm-variable">plot_hist</span>(<span class="cm-variable">im_r</span>, <span class="cm-variable">im_g</span>, <span class="cm-variable">im_b</span>,<span class="cm-string">'histogram for RGB channels'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">show</span>()</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 506px;"></div><div class="CodeMirror-gutters" style="display: none; height: 506px;"></div></div></div></pre><p><img src="img/Chapter4/output_7_0.png" referrerpolicy="no-referrer" alt="png"></p><p><span>The screenshot above shows the output—the histograms for the color channels for the original image before applying the log transformation</span></p><p><span>Let&#39;s now apply a log transform using the PIL image module&#39;s point()function and impact on the transformation on the histograms of different color channels for an RGB image:</span></p><p><span>The output shows how the histograms are squeezed for different color channels.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">im</span> = <span class="cm-variable">im</span>.<span class="cm-property">point</span>(<span class="cm-keyword">lambda</span> <span class="cm-variable">i</span>: <span class="cm-number">255</span><span class="cm-operator">*</span><span class="cm-variable">np</span>.<span class="cm-property">log</span>(<span class="cm-number">1</span><span class="cm-operator">+</span><span class="cm-variable">i</span><span class="cm-operator">/</span><span class="cm-number">255</span>))</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">im_r</span>, <span class="cm-variable">im_g</span>, <span class="cm-variable">im_b</span> = <span class="cm-variable">im</span>.<span class="cm-property">split</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">style</span>.<span class="cm-property">use</span>(<span class="cm-string">'ggplot'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">figure</span>(<span class="cm-variable">figsize</span>=(<span class="cm-number">15</span>,<span class="cm-number">5</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">subplot</span>(<span class="cm-number">121</span>), <span class="cm-variable">plot_image</span>(<span class="cm-variable">im</span>, <span class="cm-string">'image after log transform'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">subplot</span>(<span class="cm-number">122</span>), <span class="cm-variable">plot_hist</span>(<span class="cm-variable">im_r</span>, <span class="cm-variable">im_g</span>, <span class="cm-variable">im_b</span>, <span class="cm-string">'histogram of RGB channels log transform'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">show</span>()</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 184px;"></div><div class="CodeMirror-gutters" style="display: none; height: 184px;"></div></div></div></pre><p><img src="img/Chapter4/output_9_0.png" referrerpolicy="no-referrer" alt="png"></p><h3 id='power-law-transform'><span>Power-law transform</span></h3><p><span>As we have already seen, this point transform (the transfer function is of the general form, </span><em><em><strong><span>s=T(r) = c.rγ [format error]</span></strong></em></em><span>, where c is a constant) on a grayscale image using the PIL point() function in the Chapter 1, Getting Started with Image Processing, let&#39;s apply power-law transform on a RGB color image with </span><em><em><strong><span>scikit-image</span></strong></em></em><span> this time, and then visualize the impact of the transform on the color channel histograms:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">im</span> = <span class="cm-variable">img_as_float</span>(<span class="cm-variable">imread</span>(<span class="cm-string">'../images/earthfromsky.jpg'</span>))</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># im = Image.open("../images/parrot.png")</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">title</span>(<span class="cm-string">"original input image"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">imshow</span>(<span class="cm-variable">im</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">axis</span>(<span class="cm-string">"off"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">show</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">gamma</span> = <span class="cm-number">5</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">im1</span> = <span class="cm-variable">im</span><span class="cm-operator">**</span><span class="cm-variable">gamma</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># TypeError: unsupported operand type(s) for ** or pow(): 'PngImageFile' and 'int'</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">style</span>.<span class="cm-property">use</span>(<span class="cm-string">'ggplot'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">figure</span>(<span class="cm-variable">figsize</span>=(<span class="cm-number">15</span>,<span class="cm-number">5</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">subplot</span>(<span class="cm-number">121</span>), <span class="cm-variable">plot_hist</span>(<span class="cm-variable">im</span>[...,<span class="cm-number">0</span>], <span class="cm-variable">im</span>[...,<span class="cm-number">1</span>], <span class="cm-variable">im</span>[...,<span class="cm-number">2</span>], <span class="cm-string">'histogram for RGB channels (input)'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">subplot</span>(<span class="cm-number">122</span>), <span class="cm-variable">plot_hist</span>(<span class="cm-variable">im1</span>[...,<span class="cm-number">0</span>], <span class="cm-variable">im1</span>[...,<span class="cm-number">1</span>], <span class="cm-variable">im1</span>[...,<span class="cm-number">2</span>], <span class="cm-string">'histogram for RGB channels (output)'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">show</span>()</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 368px;"></div><div class="CodeMirror-gutters" style="display: none; height: 368px;"></div></div></div></pre><p><img src="img/Chapter4/output_11_0.png" referrerpolicy="no-referrer" alt="png"></p><p>&nbsp;</p><p><img src="img/Chapter4/output_11_1.png" referrerpolicy="no-referrer" alt="png"></p><h3 id='contrast-stretching-with-pil-as-a-point-operation'><span>Contrast stretching with PIL as a point operation</span></h3><p><span>The contrast stretching operation takes a low-contrast image as input and stretches the narrower range of the intensity values to span a desired wider range of values in order to output a high-contrast output image, thereby enhancing the image&#39;s contrast. It is just a linear scaling function that is applied to image pixel values, and hence the image enhancement is less drastic (than its more sophisticated counterpart histogram equalization, to be described shortly). The following screenshot shows the point transformation function for contrast stretching:</span></p><p><img src="images/ch-4-2.png" referrerpolicy="no-referrer" alt="png"></p><p>&nbsp;</p><p><span>As can be seen from the previous screenshot, the upper and lower pixel value limits (over which the image is to be normalized), need to be specified before the stretching can be performed (for example, for a gray-level image, the limits are often set to 0 and 255, in order for the output image to span the entire range of available pixel values). All we need to find is a suitable value of m from the CDF of the original image. The contrast stretching transform produces higher contrast than the original by darkening the levels below the value m (in other words, stretching the values toward the lower limit) in the original image and brightening the levels previous to value m (stretching the values toward the upper limit) in the original image. The following sections describe how to implement contrast-stretching using the PIL library.</span></p><p><strong><span>Using PIL as a point operation</span></strong></p><p><span>Let us first load a colored RGB image and split it across the color channels to visualize the histograms of pixel values for different color channels:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">im</span> = <span class="cm-variable">Image</span>.<span class="cm-property">open</span>(<span class="cm-string">'../images/cheetah.png'</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">im_r</span>, <span class="cm-variable">im_g</span>, <span class="cm-variable">im_b</span>, <span class="cm-variable">_</span> = <span class="cm-variable">im</span>.<span class="cm-property">split</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">style</span>.<span class="cm-property">use</span>(<span class="cm-string">'ggplot'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">figure</span>(<span class="cm-variable">figsize</span>=(<span class="cm-number">15</span>,<span class="cm-number">5</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">subplot</span>(<span class="cm-number">121</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plot_image</span>(<span class="cm-variable">im</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">subplot</span>(<span class="cm-number">122</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plot_hist</span>(<span class="cm-variable">im_r</span>, <span class="cm-variable">im_g</span>, <span class="cm-variable">im_b</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">show</span>()</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 207px;"></div><div class="CodeMirror-gutters" style="display: none; height: 207px;"></div></div></div></pre><p><img src="img/Chapter4/output_13_0.png" referrerpolicy="no-referrer" alt="png"></p><p><span>The picture above shows the output of the previous code block. As can be seen, the input cheetah image is a low-contrast image since the color channel histograms are concentrated at a certain range of values (right-skewed), not spread over all possible pixel values</span></p><p><strong><span>Contrast stretching Using the PIL ImageEnhance module</span></strong></p><p><span>The contrast stretching operation stretches the over-concentrated gray-levels. The transfer function can be thought of as a piece-wise linear function, where the slope in the stretching region is greater than one. This can be seen from the following screenshot</span></p><p><img src="images/ch-4-3.png" referrerpolicy="no-referrer" alt="png"></p><p>&nbsp;</p><p><span>The following code block shows how the PIL point()function can be used to implement contrast stretching. The transfer function is defined by the contrast() function as a piece wise linear function</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><span><span>​</span>x</span></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">def</span> <span class="cm-def">contrast</span>(<span class="cm-variable">c</span>):</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-number">0</span> <span class="cm-keyword">if</span> <span class="cm-variable">c</span> <span class="cm-operator">&lt;</span> <span class="cm-number">70</span> <span class="cm-keyword">else</span> (<span class="cm-number">255</span> <span class="cm-keyword">if</span> <span class="cm-variable">c</span> <span class="cm-operator">&gt;</span> <span class="cm-number">150</span> <span class="cm-keyword">else</span> (<span class="cm-number">255</span><span class="cm-operator">*</span><span class="cm-variable">c</span> <span class="cm-operator">-</span> <span class="cm-number">22950</span>) <span class="cm-operator">/</span> <span class="cm-number">48</span>) <span class="cm-comment"># piece-wise linear function</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">im1</span> = <span class="cm-variable">im</span>.<span class="cm-property">point</span>(<span class="cm-variable">contrast</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">im_r</span>, <span class="cm-variable">im_g</span>, <span class="cm-variable">im_b</span>, <span class="cm-variable">_</span> = <span class="cm-variable">im1</span>.<span class="cm-property">split</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">style</span>.<span class="cm-property">use</span>(<span class="cm-string">'ggplot'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">figure</span>(<span class="cm-variable">figsize</span>=(<span class="cm-number">15</span>,<span class="cm-number">5</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">subplot</span>(<span class="cm-number">121</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plot_image</span>(<span class="cm-variable">im1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">subplot</span>(<span class="cm-number">122</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plot_hist</span>(<span class="cm-variable">im_r</span>, <span class="cm-variable">im_g</span>, <span class="cm-variable">im_b</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">yscale</span>(<span class="cm-string">'log'</span>,<span class="cm-variable">basey</span>=<span class="cm-number">10</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">show</span>()</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 322px;"></div><div class="CodeMirror-gutters" style="display: none; height: 322px;"></div></div></div></pre><p><img src="img/Chapter4/output_16_0.png" referrerpolicy="no-referrer" alt="png"></p><p><span>The following picure above shows the output. As can be seen, the histogram of each channel has been stretched to the endpoints of the pixel values with the point operation</span></p><p><strong><span>Using the PIL ImageEnhance module</span></strong></p><p><span>The ImageEnhance module can also be used for contrast stretching. The following code block shows how to use the enhance() method from the contrast object to enhance the contrast of the same input image</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">contrast</span> = <span class="cm-variable">ImageEnhance</span>.<span class="cm-property">Contrast</span>(<span class="cm-variable">im</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">im1</span> = <span class="cm-variable">np</span>.<span class="cm-property">reshape</span>(<span class="cm-variable">np</span>.<span class="cm-property">array</span>(<span class="cm-variable">contrast</span>.<span class="cm-property">enhance</span>(<span class="cm-number">2</span>).<span class="cm-property">getdata</span>()).<span class="cm-property">astype</span>(<span class="cm-variable">np</span>.<span class="cm-property">uint8</span>), (<span class="cm-variable">im</span>.<span class="cm-property">height</span>, <span class="cm-variable">im</span>.<span class="cm-property">width</span>, <span class="cm-number">4</span>)) </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">style</span>.<span class="cm-property">use</span>(<span class="cm-string">'ggplot'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">figure</span>(<span class="cm-variable">figsize</span>=(<span class="cm-number">15</span>,<span class="cm-number">5</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">subplot</span>(<span class="cm-number">121</span>), <span class="cm-variable">plot_image</span>(<span class="cm-variable">im1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">subplot</span>(<span class="cm-number">122</span>), <span class="cm-variable">plot_hist</span>(<span class="cm-variable">im1</span>[...,<span class="cm-number">0</span>], <span class="cm-variable">im1</span>[...,<span class="cm-number">1</span>], <span class="cm-variable">im1</span>[...,<span class="cm-number">2</span>]), <span class="cm-variable">pylab</span>.<span class="cm-property">yscale</span>(<span class="cm-string">'log'</span>,<span class="cm-variable">basey</span>=<span class="cm-number">10</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">show</span>()</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 207px;"></div><div class="CodeMirror-gutters" style="display: none; height: 207px;"></div></div></div></pre><p><img src="img/Chapter4/output_19_0.png" referrerpolicy="no-referrer" alt="png"></p><p><span>The picture above shows the output of the code. As can be seen, the contrast of the input image has been enhanced and the color channel histograms are stretched towards the endpoints</span></p><h3 id='thresholding'><span>Thresholding</span></h3><p><span>This is a point operation that creates binary images from gray-level ones by turning all pixels below some threshold to zero and all pixels above that threshold to one, as shown in the following screenshot</span></p><p><img src="images/ch-4-4.png" referrerpolicy="no-referrer" alt="png"></p><p>&nbsp;</p><p><span>If g(x, y) is a thresholded version of f(x, y) at some global threshold T, then the following can be applied</span></p><p><img src="images/eq-4-1.png" referrerpolicy="no-referrer" alt="png"></p><p>&nbsp;</p><p><span>Why do we need a binary image? A few reasons are, for example, that we may be interested in separating an image into foreground and background; that the image is to be printed with a black and white printer (and all the shades of gray need to be represented using black and white dots only); or that we want to pre-process the image with morphological operations, as we shall discuss later in this chapter.</span></p><h4 id='thresholding-with-a-fixed-threshold'><span>Thresholding With a fixed threshold</span></h4><p><span>The following code block shows how to to use the PIL point()function for thresholding with a fixed threshold:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">im</span> = <span class="cm-variable">Image</span>.<span class="cm-property">open</span>(<span class="cm-string">'../images/swans.jpg'</span>).<span class="cm-property">convert</span>(<span class="cm-string">'L'</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">hist</span>(<span class="cm-variable">np</span>.<span class="cm-property">array</span>(<span class="cm-variable">im</span>).<span class="cm-property">ravel</span>(), <span class="cm-variable">bins</span>=<span class="cm-number">256</span>, <span class="cm-builtin">range</span>=(<span class="cm-number">0</span>, <span class="cm-number">256</span>), <span class="cm-variable">color</span>=<span class="cm-string">'g'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">xlabel</span>(<span class="cm-string">'Pixel values'</span>), <span class="cm-variable">pylab</span>.<span class="cm-property">ylabel</span>(<span class="cm-string">'Frequency'</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">title</span>(<span class="cm-string">'Histogram of pixel values'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">show</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">figure</span>(<span class="cm-variable">figsize</span>=(<span class="cm-number">12</span>,<span class="cm-number">18</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">gray</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">subplot</span>(<span class="cm-number">221</span>), <span class="cm-variable">plot_image</span>(<span class="cm-variable">im</span>, <span class="cm-string">'original image'</span>), <span class="cm-variable">pylab</span>.<span class="cm-property">axis</span>(<span class="cm-string">'off'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">th</span> = [<span class="cm-number">0</span>, <span class="cm-number">50</span>, <span class="cm-number">100</span>, <span class="cm-number">150</span>, <span class="cm-number">200</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for</span> <span class="cm-variable">i</span> <span class="cm-keyword">in</span> <span class="cm-builtin">range</span>(<span class="cm-number">2</span>, <span class="cm-number">5</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">im1</span> = <span class="cm-variable">im</span>.<span class="cm-property">point</span>(<span class="cm-keyword">lambda</span> <span class="cm-variable">x</span>: <span class="cm-variable">x</span> <span class="cm-operator">&gt;</span> <span class="cm-variable">th</span>[<span class="cm-variable">i</span>])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">pylab</span>.<span class="cm-property">subplot</span>(<span class="cm-number">2</span>,<span class="cm-number">2</span>,<span class="cm-variable">i</span>), <span class="cm-variable">plot_image</span>(<span class="cm-variable">im1</span>, <span class="cm-string">'binary image with threshold='</span> <span class="cm-operator">+</span> <span class="cm-builtin">str</span>(<span class="cm-variable">th</span>[<span class="cm-variable">i</span>]))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">show</span>()</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 322px;"></div><div class="CodeMirror-gutters" style="display: none; height: 322px;"></div></div></div></pre><p><img src="img/Chapter4/output_23_0.png" referrerpolicy="no-referrer" alt="png"></p><p>&nbsp;</p><p><img src="img/Chapter4/output_23_1.png" referrerpolicy="no-referrer" alt="png"></p><p><span>The screenshots show the output of the previous code. First, we can see the distribution of the pixel values in the input image.</span></p><p><span>Also, as can be seen from the following, the binary images obtained with different gray-level thresholds are not shaded properly—resulting in an artefact known as false contours:</span></p><h4 id='half-toning'><span>Half-toning</span></h4><p><span>One way to reduce the false contour artefacts in thresholding (binary quantization) is </span><strong><span>to add uniformly distributed white noise to the input image prior to quantization</span></strong><span>. Specifically, to each input pixel of the grayscale image, f(x, y), we add an independent uniform [-128,128] random number, and then the thresholding is done. This technique is called half-toning. The following code block shows an implementation:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">im</span> = <span class="cm-variable">Image</span>.<span class="cm-property">open</span>(<span class="cm-string">'../images/swans.jpg'</span>).<span class="cm-property">convert</span>(<span class="cm-string">'L'</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">im</span> = <span class="cm-variable">Image</span>.<span class="cm-property">fromarray</span>(<span class="cm-variable">np</span>.<span class="cm-property">clip</span>(<span class="cm-variable">im</span> <span class="cm-operator">+</span> <span class="cm-variable">np</span>.<span class="cm-property">random</span>.<span class="cm-property">randint</span>(<span class="cm-operator">-</span><span class="cm-number">128</span>, <span class="cm-number">128</span>, (<span class="cm-variable">im</span>.<span class="cm-property">height</span>, <span class="cm-variable">im</span>.<span class="cm-property">width</span>)), <span class="cm-number">0</span>, <span class="cm-number">255</span>).<span class="cm-property">astype</span>(<span class="cm-variable">np</span>.<span class="cm-property">uint8</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">figure</span>(<span class="cm-variable">figsize</span>=(<span class="cm-number">12</span>,<span class="cm-number">18</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">subplot</span>(<span class="cm-number">221</span>), <span class="cm-variable">plot_image</span>(<span class="cm-variable">im</span>, <span class="cm-string">'original image (with noise)'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">th</span> = [<span class="cm-number">0</span>, <span class="cm-number">50</span>, <span class="cm-number">100</span>, <span class="cm-number">150</span>, <span class="cm-number">200</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for</span> <span class="cm-variable">i</span> <span class="cm-keyword">in</span> <span class="cm-builtin">range</span>(<span class="cm-number">2</span>, <span class="cm-number">5</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">im1</span> = <span class="cm-variable">im</span>.<span class="cm-property">point</span>(<span class="cm-keyword">lambda</span> <span class="cm-variable">x</span>: <span class="cm-variable">x</span> <span class="cm-operator">&gt;</span> <span class="cm-variable">th</span>[<span class="cm-variable">i</span>])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">pylab</span>.<span class="cm-property">subplot</span>(<span class="cm-number">2</span>,<span class="cm-number">2</span>,<span class="cm-variable">i</span>), <span class="cm-variable">plot_image</span>(<span class="cm-variable">im1</span>, <span class="cm-string">'binary image with threshold='</span> <span class="cm-operator">+</span> &nbsp; <span class="cm-builtin">str</span>(<span class="cm-variable">th</span>[<span class="cm-variable">i</span>]))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">show</span>()</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 253px;"></div><div class="CodeMirror-gutters" style="display: none; height: 253px;"></div></div></div></pre><p><img src="img/Chapter4/output_27_0.png" referrerpolicy="no-referrer" alt="png"></p><p><span>Notice that even though the resulting binary images are somewhat noisy, the false contouring has been dramatically reduced, and with enough blurring (for example, when looking at them from a distance), they give us the impression of having several gray-levels</span></p><h3 id='floyd-steinberg-dithering-with-error-diffusion'><span>Floyd-Steinberg dithering with error diffusion</span></h3><p><span>Again, in order to prevent large-scale patterns (such as false contours), an intentionally applied form of noise is used to randomize the quantization error. This process is known as dithering. The Floyd-Steinberg algorithm implements dithering using the error diffusion technique—in other words, it pushes (adds) the residual quantization error of a pixel onto its neighboring pixels, to be dealt with later. It spreads the quantization error out according to the distribution shown in the following screenshot, as a map of the neighboring pixels</span></p><p><img src="images/ch-4-5.png" referrerpolicy="no-referrer" alt="png"></p><p><span>In the previous screenshot, the current pixel is represented with a star (*) and the blank pixels represent the previously-scanned pixels. The algorithm scans the image from left to right and top to bottom. It sequentially quantizes the pixel values one by one, each time the quantization error is distributed among the neighboring pixels (yet to be scanned), while not affecting the pixels that already got quantized. Hence, if a number of pixels have been rounded downward, it becomes more likely that the following pixel will be rounded upward by the algorithm so that the average quantization error is close to zero</span></p><h3 id='histogram-processing----histogram-equalization-and-matching'><span>Histogram processing – histogram equalization and matching</span></h3><p><span>Histogram processing techniques provide a better method for altering the dynamic range of pixel values in an image so that </span><strong><span>its intensity histogram has a desired shape</span></strong><span>. As we have seen, image enhancement by the contrast stretching operation is limited in the sense that it can apply only linear scaling functions.</span></p><p><span>Histogram processing techniques can be more powerful by employing non-linear (and non-monotonic) transfer functions to map the input pixel intensities to the output pixel intensities. In this section, we shall demonstrate the implementation of a couple of such techniques, namely histogram equalization and histogram matching, using the </span><em><strong><span>scikit-image</span></strong></em><span> library&#39;s exposure module.</span></p><h3 id='contrast-stretching-and-histogram-equalization-with-scikit-image'><span>Contrast stretching and histogram equalization with scikit-image</span></h3><p><span>Histogram equalization uses a monotonic and a non-linear mapping which reassigns the pixel intensity values in the input image in such a way that the output image has a uniform distribution of intensities (a flat histogram), and thereby enhances the contrast of the image. The following screenshot describes the transformation function for histogram equalization:</span></p><p><img src="images/ch-4-6.png" referrerpolicy="no-referrer" alt="png"></p><p><span>The following code block shows how to use the exposure module&#39;s equalize_hist() function to do histogram equalization with scikit-image. The histogram equalization implementation has two different flavors: one is a global operation over the entire image, while the second is local (adaptive) and done by dividing the image into blocks and running histogram equalization on each of them:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">img</span> = <span class="cm-variable">rgb2gray</span>(<span class="cm-variable">imread</span>(<span class="cm-string">'../images/earthfromsky.jpg'</span>))</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># histogram equalization</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">img_eq</span> = <span class="cm-variable">exposure</span>.<span class="cm-property">equalize_hist</span>(<span class="cm-variable">img</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># adaptive histogram equalization</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">img_adapteq</span> = <span class="cm-variable">exposure</span>.<span class="cm-property">equalize_adapthist</span>(<span class="cm-variable">img</span>, <span class="cm-variable">clip_limit</span>=<span class="cm-number">0.03</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">gray</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">images</span> = [<span class="cm-variable">img</span>, <span class="cm-variable">img_eq</span>, <span class="cm-variable">img_adapteq</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">titles</span> = [<span class="cm-string">'original input (earth from sky)'</span>, <span class="cm-string">'after histogram equalization'</span>, <span class="cm-string">'after adaptive histogram equalization'</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for</span> <span class="cm-variable">i</span> <span class="cm-keyword">in</span> <span class="cm-builtin">range</span>(<span class="cm-number">3</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">pylab</span>.<span class="cm-property">figure</span>(<span class="cm-variable">figsize</span>=(<span class="cm-number">20</span>,<span class="cm-number">10</span>)), <span class="cm-variable">plot_image</span>(<span class="cm-variable">images</span>[<span class="cm-variable">i</span>], <span class="cm-variable">titles</span>[<span class="cm-variable">i</span>])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">figure</span>(<span class="cm-variable">figsize</span>=(<span class="cm-number">15</span>,<span class="cm-number">5</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for</span> <span class="cm-variable">i</span> <span class="cm-keyword">in</span> <span class="cm-builtin">range</span>(<span class="cm-number">3</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">pylab</span>.<span class="cm-property">subplot</span>(<span class="cm-number">1</span>,<span class="cm-number">3</span>,<span class="cm-variable">i</span><span class="cm-operator">+</span><span class="cm-number">1</span>), <span class="cm-variable">pylab</span>.<span class="cm-property">hist</span>(<span class="cm-variable">images</span>[<span class="cm-variable">i</span>].<span class="cm-property">ravel</span>(), <span class="cm-variable">color</span>=<span class="cm-string">'g'</span>), <span class="cm-variable">pylab</span>.<span class="cm-property">title</span>(<span class="cm-variable">titles</span>[<span class="cm-variable">i</span>], <span class="cm-variable">size</span>=<span class="cm-number">15</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">show</span>()</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 368px;"></div><div class="CodeMirror-gutters" style="display: none; height: 368px;"></div></div></div></pre><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">/usr/local/lib/python3.5/dist-packages/skimage/util/dtype.py:130: UserWarning: Possible precision loss when converting from float64 to uint16</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  .format(dtypeobj_in, dtypeobj_out))</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 69px;"></div><div class="CodeMirror-gutters" style="display: none; height: 69px;"></div></div></div></pre><p>&nbsp;</p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;matplotlib.figure.Figure at 0x7ffa885ddb38&gt;</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><img src="img/Chapter4/output_32_2.png" referrerpolicy="no-referrer" alt="png"></p><p>&nbsp;</p><p><img src="img/Chapter4/output_32_3.png" referrerpolicy="no-referrer" alt="png"></p><p>&nbsp;</p><p><img src="img/Chapter4/output_32_4.png" referrerpolicy="no-referrer" alt="png"></p><p>&nbsp;</p><p><img src="img/Chapter4/output_32_5.png" referrerpolicy="no-referrer" alt="png"></p><p><span>The screenshots show the output of the previous code block. As can be seen, after histogram equalization, the output image histogram becomes almost uniform (the x axis represents pixel values and the y axis corresponding frequencies), although adaptive histogram equalization reveals the details of the image more clearly than the global histogram equalization.</span></p><p><span>The following code block compares the image enhancements obtained using two different histogram processing techniques, namely </span><strong><span>contrast stretching</span></strong><span> and </span><strong><span>histogram equalization</span></strong><span>, with </span><em><strong><span>scikit-image</span></strong></em><span>:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">matplotlib</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">matplotlib</span>.<span class="cm-property">rcParams</span>[<span class="cm-string">'font.size'</span>] = <span class="cm-number">8</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">def</span> <span class="cm-def">plot_image_and_hist</span>(<span class="cm-variable">image</span>, <span class="cm-variable">axes</span>, <span class="cm-variable">bins</span>=<span class="cm-number">256</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">image</span> = <span class="cm-variable">img_as_float</span>(<span class="cm-variable">image</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">axes_image</span>, <span class="cm-variable">axes_hist</span> = <span class="cm-variable">axes</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">axes_cdf</span> = <span class="cm-variable">axes_hist</span>.<span class="cm-property">twinx</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">axes_image</span>.<span class="cm-property">imshow</span>(<span class="cm-variable">image</span>, <span class="cm-variable">cmap</span>=<span class="cm-variable">pylab</span>.<span class="cm-property">cm</span>.<span class="cm-property">gray</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">axes_image</span>.<span class="cm-property">set_axis_off</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">axes_hist</span>.<span class="cm-property">hist</span>(<span class="cm-variable">image</span>.<span class="cm-property">ravel</span>(), <span class="cm-variable">bins</span>=<span class="cm-variable">bins</span>, <span class="cm-variable">histtype</span>=<span class="cm-string">'step'</span>, <span class="cm-variable">color</span>=<span class="cm-string">'black'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">axes_hist</span>.<span class="cm-property">set_xlim</span>(<span class="cm-number">0</span>, <span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">axes_hist</span>.<span class="cm-property">set_xlabel</span>(<span class="cm-string">'Pixel intensity'</span>, <span class="cm-variable">size</span>=<span class="cm-number">15</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">axes_hist</span>.<span class="cm-property">ticklabel_format</span>(<span class="cm-variable">axis</span>=<span class="cm-string">'y'</span>, <span class="cm-variable">style</span>=<span class="cm-string">'scientific'</span>, <span class="cm-variable">scilimits</span>=(<span class="cm-number">0</span>, <span class="cm-number">0</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">axes_hist</span>.<span class="cm-property">set_yticks</span>([])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">image_cdf</span>, <span class="cm-variable">bins</span> = <span class="cm-variable">exposure</span>.<span class="cm-property">cumulative_distribution</span>(<span class="cm-variable">image</span>, <span class="cm-variable">bins</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">axes_cdf</span>.<span class="cm-property">plot</span>(<span class="cm-variable">bins</span>, <span class="cm-variable">image_cdf</span>, <span class="cm-string">'r'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">axes_cdf</span>.<span class="cm-property">set_yticks</span>([])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">axes_image</span>, <span class="cm-variable">axes_hist</span>, <span class="cm-variable">axes_cdf</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">im</span> = <span class="cm-variable">io</span>.<span class="cm-property">imread</span>(<span class="cm-string">'../images/beans_g.png'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># contrast stretching</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">im_rescale</span> = <span class="cm-variable">exposure</span>.<span class="cm-property">rescale_intensity</span>(<span class="cm-variable">im</span>, <span class="cm-variable">in_range</span>=(<span class="cm-number">0</span>, <span class="cm-number">100</span>), <span class="cm-variable">out_range</span>=(<span class="cm-number">0</span>, <span class="cm-number">255</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">im_eq</span> = <span class="cm-variable">exposure</span>.<span class="cm-property">equalize_hist</span>(<span class="cm-variable">im</span>) <span class="cm-comment"># histogram equalization</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">im_adapteq</span> = <span class="cm-variable">exposure</span>.<span class="cm-property">equalize_adapthist</span>(<span class="cm-variable">im</span>, <span class="cm-variable">clip_limit</span>=<span class="cm-number">0.03</span>) <span class="cm-comment"># adaptive histogram equalization</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">fig</span> = <span class="cm-variable">pylab</span>.<span class="cm-property">figure</span>(<span class="cm-variable">figsize</span>=(<span class="cm-number">15</span>, <span class="cm-number">7</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">axes</span> = <span class="cm-variable">np</span>.<span class="cm-property">zeros</span>((<span class="cm-number">2</span>, <span class="cm-number">4</span>), <span class="cm-variable">dtype</span> = <span class="cm-variable">np</span>.<span class="cm-property">object</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">axes</span>[<span class="cm-number">0</span>, <span class="cm-number">0</span>] = <span class="cm-variable">fig</span>.<span class="cm-property">add_subplot</span>(<span class="cm-number">2</span>, <span class="cm-number">4</span>, <span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for</span> <span class="cm-variable">i</span> <span class="cm-keyword">in</span> <span class="cm-builtin">range</span>(<span class="cm-number">1</span>, <span class="cm-number">4</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">axes</span>[<span class="cm-number">0</span>, <span class="cm-variable">i</span>] = <span class="cm-variable">fig</span>.<span class="cm-property">add_subplot</span>(<span class="cm-number">2</span>, <span class="cm-number">4</span>, <span class="cm-number">1</span><span class="cm-operator">+</span><span class="cm-variable">i</span>, <span class="cm-variable">sharex</span>=<span class="cm-variable">axes</span>[<span class="cm-number">0</span>,<span class="cm-number">0</span>], <span class="cm-variable">sharey</span>=<span class="cm-variable">axes</span>[<span class="cm-number">0</span>,<span class="cm-number">0</span>])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for</span> <span class="cm-variable">i</span> <span class="cm-keyword">in</span> <span class="cm-builtin">range</span>(<span class="cm-number">0</span>, <span class="cm-number">4</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">axes</span>[<span class="cm-number">1</span>, <span class="cm-variable">i</span>] = <span class="cm-variable">fig</span>.<span class="cm-property">add_subplot</span>(<span class="cm-number">2</span>, <span class="cm-number">4</span>, <span class="cm-number">5</span><span class="cm-operator">+</span><span class="cm-variable">i</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">axes_image</span>, <span class="cm-variable">axes_hist</span>, <span class="cm-variable">axes_cdf</span> = <span class="cm-variable">plot_image_and_hist</span>(<span class="cm-variable">im</span>, <span class="cm-variable">axes</span>[:, <span class="cm-number">0</span>])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">axes_image</span>.<span class="cm-property">set_title</span>(<span class="cm-string">'Low contrast image'</span>, <span class="cm-variable">size</span>=<span class="cm-number">20</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">y_min</span>, <span class="cm-variable">y_max</span> = <span class="cm-variable">axes_hist</span>.<span class="cm-property">get_ylim</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">axes_hist</span>.<span class="cm-property">set_ylabel</span>(<span class="cm-string">'Number of pixels'</span>, <span class="cm-variable">size</span>=<span class="cm-number">20</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">axes_hist</span>.<span class="cm-property">set_yticks</span>(<span class="cm-variable">np</span>.<span class="cm-property">linspace</span>(<span class="cm-number">0</span>, <span class="cm-variable">y_max</span>, <span class="cm-number">5</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">axes_image</span>, <span class="cm-variable">axes_hist</span>, <span class="cm-variable">axes_cdf</span> = <span class="cm-variable">plot_image_and_hist</span>(<span class="cm-variable">im_rescale</span>, <span class="cm-variable">axes</span>[:,<span class="cm-number">1</span>])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">axes_image</span>.<span class="cm-property">set_title</span>(<span class="cm-string">'Contrast stretching'</span>, <span class="cm-variable">size</span>=<span class="cm-number">20</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">axes_image</span>, <span class="cm-variable">axes_hist</span>, <span class="cm-variable">axes_cdf</span> = <span class="cm-variable">plot_image_and_hist</span>(<span class="cm-variable">im_eq</span>, <span class="cm-variable">axes</span>[:, <span class="cm-number">2</span>])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">axes_image</span>.<span class="cm-property">set_title</span>(<span class="cm-string">'Histogram equalization'</span>, <span class="cm-variable">size</span>=<span class="cm-number">20</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">axes_image</span>, <span class="cm-variable">axes_hist</span>, <span class="cm-variable">axes_cdf</span> = <span class="cm-variable">plot_image_and_hist</span>(<span class="cm-variable">im_adapteq</span>, <span class="cm-variable">axes</span>[:,<span class="cm-number">3</span>])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">axes_image</span>.<span class="cm-property">set_title</span>(<span class="cm-string">'Adaptive equalization'</span>, <span class="cm-variable">size</span>=<span class="cm-number">20</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">axes_cdf</span>.<span class="cm-property">set_ylabel</span>(<span class="cm-string">'Fraction of total intensity'</span>, <span class="cm-variable">size</span>=<span class="cm-number">20</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">axes_cdf</span>.<span class="cm-property">set_yticks</span>(<span class="cm-variable">np</span>.<span class="cm-property">linspace</span>(<span class="cm-number">0</span>, <span class="cm-number">1</span>, <span class="cm-number">5</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">fig</span>.<span class="cm-property">tight_layout</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">show</span>()</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1081px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1081px;"></div></div></div></pre><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">/usr/local/lib/python3.5/dist-packages/skimage/exposure/exposure.py:63: UserWarning: This might be a color image. The histogram will be computed on the flattened image. You can instead apply this function to each color channel.</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  warn("This might be a color image. The histogram will be "</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 92px;"></div><div class="CodeMirror-gutters" style="display: none; height: 92px;"></div></div></div></pre><p>&nbsp;</p><p><img src="img/Chapter4/output_35_1.png" referrerpolicy="no-referrer" alt="png"></p><p>&nbsp;</p><p><span>The screenshot shows the output of the previous code. As can be seen, adaptive histogram equalization provides better results than histogram equalization in terms of making the details of the output image clearer.</span></p><h3 id='histogram-matching'><span>Histogram Matching</span></h3><p><span>Histogram matching is a process where an image is altered in such a way that its histogram matches that of another reference (template) image&#39;s histogram. The algorithm is as follows:</span></p><ol start='' ><li><span>The cumulative histogram is computed for each image, as shown in the following screenshot.</span></li><li><span>For any given pixel value, xi, in the input image (to be adjusted), we need to find the corresponding pixel value, xj, in the output image by matching the input image&#39;s histogram with the template image&#39;s histogram.</span></li><li><span>The xi pixel value has a cumulative histogram value given by G(xi). Find a pixel value, xj,so that the cumulative distribution value in the reference image, namely H(xj), is equal to G(xi).</span></li><li><span>The input data value xi is replaced by xj:</span></li></ol><p><img src="images/ch-4-7.png" referrerpolicy="no-referrer" alt="png"></p><p>&nbsp;</p><p><span>The following code block shows how histogram matching can be implemented using Pytho</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">def</span> <span class="cm-def">cdf</span>(<span class="cm-variable">im</span>):</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string">'''</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp;  computes the CDF of an image im as 2D numpy ndarray</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp;  '''</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">c</span>, <span class="cm-variable">b</span> = <span class="cm-variable">cumulative_distribution</span>(<span class="cm-variable">im</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment"># pad the beginning and ending pixels and their CDF values</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">c</span> = <span class="cm-variable">np</span>.<span class="cm-property">insert</span>(<span class="cm-variable">c</span>, <span class="cm-number">0</span>, [<span class="cm-number">0</span>]<span class="cm-operator">*</span><span class="cm-variable">b</span>[<span class="cm-number">0</span>])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">c</span> = <span class="cm-variable">np</span>.<span class="cm-property">append</span>(<span class="cm-variable">c</span>, [<span class="cm-number">1</span>]<span class="cm-operator">*</span>(<span class="cm-number">255</span><span class="cm-operator">-</span><span class="cm-variable">b</span>[<span class="cm-operator">-</span><span class="cm-number">1</span>]))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">c</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">def</span> <span class="cm-def">hist_matching</span>(<span class="cm-variable">c</span>, <span class="cm-variable">c_t</span>, <span class="cm-variable">im</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string">'''</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp;  c: CDF of input image computed with the function cdf()</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp;  c_t: CDF of template image computed with the function cdf()</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp;  im: input image as 2D numpy ndarray</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp;  returns the modified pixel values for the input image</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp;  '''</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">pixels</span> = <span class="cm-variable">np</span>.<span class="cm-property">arange</span>(<span class="cm-number">256</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment"># find closest pixel-matches corresponding to the CDF of the input image, given the value of the CDF H of</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment"># the template image at the corresponding pixels, s.t. c_t = H(pixels) &lt;=&gt; pixels = H-1(c_t)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">new_pixels</span> = <span class="cm-variable">np</span>.<span class="cm-property">interp</span>(<span class="cm-variable">c</span>, <span class="cm-variable">c_t</span>, <span class="cm-variable">pixels</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">im</span> = (<span class="cm-variable">np</span>.<span class="cm-property">reshape</span>(<span class="cm-variable">new_pixels</span>[<span class="cm-variable">im</span>.<span class="cm-property">ravel</span>()], <span class="cm-variable">im</span>.<span class="cm-property">shape</span>)).<span class="cm-property">astype</span>(<span class="cm-variable">np</span>.<span class="cm-property">uint8</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">im</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">gray</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">im</span> = (<span class="cm-variable">rgb2gray</span>(<span class="cm-variable">imread</span>(<span class="cm-string">'../images/beans_g.png'</span>))<span class="cm-operator">*</span><span class="cm-number">255</span>).<span class="cm-property">astype</span>(<span class="cm-variable">np</span>.<span class="cm-property">uint8</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">im_t</span> = (<span class="cm-variable">rgb2gray</span>(<span class="cm-variable">imread</span>(<span class="cm-string">'../images/lena_g.png'</span>))<span class="cm-operator">*</span><span class="cm-number">255</span>).<span class="cm-property">astype</span>(<span class="cm-variable">np</span>.<span class="cm-property">uint8</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">figure</span>(<span class="cm-variable">figsize</span>=(<span class="cm-number">20</span>,<span class="cm-number">12</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">subplot</span>(<span class="cm-number">2</span>,<span class="cm-number">3</span>,<span class="cm-number">1</span>), <span class="cm-variable">plot_image</span>(<span class="cm-variable">im</span>, <span class="cm-string">'Input image'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">subplot</span>(<span class="cm-number">2</span>,<span class="cm-number">3</span>,<span class="cm-number">2</span>), <span class="cm-variable">plot_image</span>(<span class="cm-variable">im_t</span>, <span class="cm-string">'Template image'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">c</span> = <span class="cm-variable">cdf</span>(<span class="cm-variable">im</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">c_t</span> = <span class="cm-variable">cdf</span>(<span class="cm-variable">im_t</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">subplot</span>(<span class="cm-number">2</span>,<span class="cm-number">3</span>,<span class="cm-number">3</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">p</span> = <span class="cm-variable">np</span>.<span class="cm-property">arange</span>(<span class="cm-number">256</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">plot</span>(<span class="cm-variable">p</span>, <span class="cm-variable">c</span>, <span class="cm-string">'r.-'</span>, <span class="cm-variable">label</span>=<span class="cm-string">'input'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">plot</span>(<span class="cm-variable">p</span>, <span class="cm-variable">c_t</span>, <span class="cm-string">'b.-'</span>, <span class="cm-variable">label</span>=<span class="cm-string">'template'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">legend</span>(<span class="cm-variable">prop</span>={<span class="cm-string">'size'</span>: <span class="cm-number">15</span>})</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">title</span>(<span class="cm-string">'CDF'</span>, <span class="cm-variable">size</span>=<span class="cm-number">20</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">im</span> = <span class="cm-variable">hist_matching</span>(<span class="cm-variable">c</span>, <span class="cm-variable">c_t</span>, <span class="cm-variable">im</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">subplot</span>(<span class="cm-number">2</span>,<span class="cm-number">3</span>,<span class="cm-number">4</span>), <span class="cm-variable">plot_image</span>(<span class="cm-variable">im</span>, <span class="cm-string">'Output image with Hist. Matching'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">c1</span> = <span class="cm-variable">cdf</span>(<span class="cm-variable">im</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">subplot</span>(<span class="cm-number">2</span>,<span class="cm-number">3</span>,<span class="cm-number">5</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">plot</span>(<span class="cm-variable">np</span>.<span class="cm-property">arange</span>(<span class="cm-number">256</span>), <span class="cm-variable">c</span>, <span class="cm-string">'r.-'</span>, <span class="cm-variable">label</span>=<span class="cm-string">'input'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">plot</span>(<span class="cm-variable">np</span>.<span class="cm-property">arange</span>(<span class="cm-number">256</span>), <span class="cm-variable">c_t</span>, <span class="cm-string">'b.-'</span>, <span class="cm-variable">label</span>=<span class="cm-string">'template'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">plot</span>(<span class="cm-variable">np</span>.<span class="cm-property">arange</span>(<span class="cm-number">256</span>), <span class="cm-variable">c1</span>, <span class="cm-string">'g.-'</span>, <span class="cm-variable">label</span>=<span class="cm-string">'output'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">legend</span>(<span class="cm-variable">prop</span>={<span class="cm-string">'size'</span>: <span class="cm-number">15</span>})</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">title</span>(<span class="cm-string">'CDF'</span>, <span class="cm-variable">size</span>=<span class="cm-number">20</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">show</span>()</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1150px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1150px;"></div></div></div></pre><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;matplotlib.figure.Figure at 0x7ffa84b69390&gt;</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><img src="img/Chapter4/output_38_1.png" referrerpolicy="no-referrer" alt="png"></p><p>&nbsp;</p><p><span>The following picture above shows the output of the previous code. As can be seen, the output bean image&#39;s CDF coincides with the input Lena image&#39;s CDF after histogram matching, and this enhances the contrast of the low-contrast input bean image</span></p><h3 id='histogram-matching-for-an-rgb-image'><span>Histogram matching for an RGB image</span></h3><p><span>For each of the color channels, the matching can be done independently to obtain output as in the following</span></p><p>&nbsp;</p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">%</span><span class="cm-variable">matplotlib</span> <span class="cm-variable">inline</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">skimage</span>.<span class="cm-property">exposure</span> <span class="cm-keyword">import</span> <span class="cm-variable">cumulative_distribution</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">skimage</span>.<span class="cm-property">color</span> <span class="cm-keyword">import</span> <span class="cm-variable">rgb2gray</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">matplotlib</span>.<span class="cm-property">pylab</span> <span class="cm-keyword">as</span> <span class="cm-variable">plt</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">numpy</span> <span class="cm-keyword">as</span> <span class="cm-variable">np</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">def</span> <span class="cm-def">hist_matching</span>(<span class="cm-variable">c</span>, <span class="cm-variable">c_t</span>, <span class="cm-variable">im</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">b</span> = <span class="cm-variable">np</span>.<span class="cm-property">interp</span>(<span class="cm-variable">c</span>, <span class="cm-variable">c_t</span>, <span class="cm-variable">np</span>.<span class="cm-property">arange</span>(<span class="cm-number">256</span>)) &nbsp; <span class="cm-comment"># find closest matches to b_t</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">pix_repl</span> = {<span class="cm-variable">i</span>:<span class="cm-variable">b</span>[<span class="cm-variable">i</span>] <span class="cm-keyword">for</span> <span class="cm-variable">i</span> <span class="cm-keyword">in</span> <span class="cm-builtin">range</span>(<span class="cm-number">256</span>)} <span class="cm-comment"># dictionary to replace the pixels</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">mp</span> = <span class="cm-variable">np</span>.<span class="cm-property">arange</span>(<span class="cm-number">0</span>,<span class="cm-number">256</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable">k</span>, <span class="cm-variable">v</span>) <span class="cm-keyword">in</span> <span class="cm-variable">pix_repl</span>.<span class="cm-property">items</span>():</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">mp</span>[<span class="cm-variable">k</span>] = <span class="cm-variable">v</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s</span> = <span class="cm-variable">im</span>.<span class="cm-property">shape</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">im</span> = <span class="cm-variable">np</span>.<span class="cm-property">reshape</span>(<span class="cm-variable">mp</span>[<span class="cm-variable">im</span>.<span class="cm-property">ravel</span>()], <span class="cm-variable">im</span>.<span class="cm-property">shape</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">im</span> = <span class="cm-variable">np</span>.<span class="cm-property">reshape</span>(<span class="cm-variable">im</span>, <span class="cm-variable">s</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">im</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">def</span> <span class="cm-def">cdf</span>(<span class="cm-variable">im</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">c</span>, <span class="cm-variable">b</span> = <span class="cm-variable">cumulative_distribution</span>(<span class="cm-variable">im</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">#print(b)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">for</span> <span class="cm-variable">i</span> <span class="cm-keyword">in</span> <span class="cm-builtin">range</span>(<span class="cm-variable">b</span>[<span class="cm-number">0</span>]):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">c</span> = <span class="cm-variable">np</span>.<span class="cm-property">insert</span>(<span class="cm-variable">c</span>, <span class="cm-number">0</span>, <span class="cm-number">0</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">for</span> <span class="cm-variable">i</span> <span class="cm-keyword">in</span> <span class="cm-builtin">range</span>(<span class="cm-variable">b</span>[<span class="cm-operator">-</span><span class="cm-number">1</span>]<span class="cm-operator">+</span><span class="cm-number">1</span>, <span class="cm-number">256</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">c</span> = <span class="cm-variable">np</span>.<span class="cm-property">append</span>(<span class="cm-variable">c</span>, <span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">c</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">im</span> = <span class="cm-variable">imread</span>(<span class="cm-string">'../images/cheetah.png'</span>).<span class="cm-property">astype</span>(<span class="cm-variable">np</span>.<span class="cm-property">uint8</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">im_t</span> = <span class="cm-variable">imread</span>(<span class="cm-string">'../images/lena.jpg'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-variable">np</span>.<span class="cm-property">max</span>(<span class="cm-variable">im</span>), <span class="cm-variable">np</span>.<span class="cm-property">max</span>(<span class="cm-variable">im_t</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">im1</span> = <span class="cm-variable">np</span>.<span class="cm-property">zeros</span>(<span class="cm-variable">im</span>.<span class="cm-property">shape</span>).<span class="cm-property">astype</span>(<span class="cm-variable">np</span>.<span class="cm-property">uint8</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for</span> <span class="cm-variable">i</span> <span class="cm-keyword">in</span> <span class="cm-builtin">range</span>(<span class="cm-number">3</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">c</span> = <span class="cm-variable">cdf</span>(<span class="cm-variable">im</span>[...,<span class="cm-variable">i</span>])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">c_t</span> = <span class="cm-variable">cdf</span>(<span class="cm-variable">im_t</span>[...,<span class="cm-variable">i</span>])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">im1</span>[...,<span class="cm-variable">i</span>] = <span class="cm-variable">hist_matching</span>(<span class="cm-variable">c</span>, <span class="cm-variable">c_t</span>, <span class="cm-variable">im</span>[...,<span class="cm-variable">i</span>])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plt</span>.<span class="cm-property">figure</span>(<span class="cm-variable">figsize</span>=(<span class="cm-number">30</span>,<span class="cm-number">10</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plt</span>.<span class="cm-property">subplot</span>(<span class="cm-number">131</span>), <span class="cm-variable">plt</span>.<span class="cm-property">imshow</span>(<span class="cm-variable">im</span>), <span class="cm-variable">plt</span>.<span class="cm-property">axis</span>(<span class="cm-string">'off'</span>), <span class="cm-variable">plt</span>.<span class="cm-property">title</span>(<span class="cm-string">'Input Image'</span>, <span class="cm-variable">size</span>=<span class="cm-number">25</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plt</span>.<span class="cm-property">subplot</span>(<span class="cm-number">132</span>), <span class="cm-variable">plt</span>.<span class="cm-property">imshow</span>(<span class="cm-variable">im_t</span>), <span class="cm-variable">plt</span>.<span class="cm-property">axis</span>(<span class="cm-string">'off'</span>), <span class="cm-variable">plt</span>.<span class="cm-property">title</span>(<span class="cm-string">'Template Image'</span>, <span class="cm-variable">size</span>=<span class="cm-number">25</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plt</span>.<span class="cm-property">subplot</span>(<span class="cm-number">133</span>), <span class="cm-variable">plt</span>.<span class="cm-property">imshow</span>(<span class="cm-variable">im1</span>[...,:<span class="cm-number">3</span>]), <span class="cm-variable">plt</span>.<span class="cm-property">axis</span>(<span class="cm-string">'off'</span>), <span class="cm-variable">plt</span>.<span class="cm-property">title</span>(<span class="cm-string">'Output Image'</span>, <span class="cm-variable">size</span>=<span class="cm-number">25</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plt</span>.<span class="cm-property">show</span>()</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1012px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1012px;"></div></div></div></pre><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">255 255</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><img src="img/Chapter4/output_41_1.png" referrerpolicy="no-referrer" alt="png"></p><p>&nbsp;</p><h3 id='linear-noise-smoothing'><span>Linear noise smoothing</span></h3><p><span>Linear (spatial) filtering is a function with a weighted sum of pixel values (in a neighborhood). It is a linear operation on an image that can be used for blurring/noise reduction. Blurring is used in pre-processing steps; for example, in the removal of small (irrelevant) details. A few popular linear filters are the box filter and the Gaussian filter. The filter is implemented with a small (for example, 3 x 3) kernel (mask), and the pixel values are recomputed by sliding the mask over the input image and applying the filter function to every possible pixel in the input image (the input image&#39;s center pixel value corresponding to the mask is replaced by the weighted sum of pixel values, with the weights from the mask). The box filter (also called the averaging filter), for example, replaces each pixel with an average of its neighborhood and achieves a smoothing effect(by removing sharp features; for example, it blurs edges, whereas spatial averaging removes noise).</span></p><p><span>The following sections illustrate how to apply linear noise smoothing on images first using the PIL ImageFilter module and then using the SciPy ndimage module&#39;s filter functions.</span></p><h4 id='smoothing-with-pil-1'><span>Smoothing with PIL</span></h4><p><span>The following sections demonstrate how the functions from the PIL ImageFilter module can be used for linear noise smoothing; in other words, noise smoothing with linear filters.</span></p><h4 id='smoothing-with-imagefilterblur'><span>Smoothing with ImageFilter.BLUR</span></h4><p><span>The following shows how the PIL ImageFilter module&#39;s filter function can be used to apply a blur to denoise a noisy image. The noise level on the input image is varied to see its impact on the blur filter. The popular mandrill (baboon) image is used as the input image for this example; the image is protected by a Creative Commons license (</span><a href='https://creativecommons.org/licenses/by-sa/2.0/' target='_blank' class='url'>https://creativecommons.org/licenses/by-sa/2.0/</a><span>) and can be found at </span><a href='https://www.flickr.com/photos/uhuru1701/2249220078' target='_blank' class='url'>https://www.flickr.com/photos/uhuru1701/2249220078</a><span> and in the SIPI image database: </span><a href='http://sipi.usc.edu/database/database.php?volume=misc&amp;image=10#top' target='_blank' class='url'>http://sipi.usc.edu/database/database.php?volume=misc&image=10#top</a><span>:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">i</span> = <span class="cm-number">1</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">figure</span>(<span class="cm-variable">figsize</span>=(<span class="cm-number">10</span>,<span class="cm-number">25</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for</span> <span class="cm-variable">prop_noise</span> <span class="cm-keyword">in</span> <span class="cm-variable">np</span>.<span class="cm-property">linspace</span>(<span class="cm-number">0.05</span>,<span class="cm-number">0.3</span>,<span class="cm-number">3</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">im</span> = <span class="cm-variable">Image</span>.<span class="cm-property">open</span>(<span class="cm-string">'../images/mandrill.jpg'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment"># choose 5000 random locations inside image</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">n</span> = <span class="cm-builtin">int</span>(<span class="cm-variable">im</span>.<span class="cm-property">width</span> <span class="cm-operator">*</span> <span class="cm-variable">im</span>.<span class="cm-property">height</span> <span class="cm-operator">*</span> <span class="cm-variable">prop_noise</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">x</span>, <span class="cm-variable">y</span> = <span class="cm-variable">np</span>.<span class="cm-property">random</span>.<span class="cm-property">randint</span>(<span class="cm-number">0</span>, <span class="cm-variable">im</span>.<span class="cm-property">width</span>, <span class="cm-variable">n</span>), <span class="cm-variable">np</span>.<span class="cm-property">random</span>.<span class="cm-property">randint</span>(<span class="cm-number">0</span>, <span class="cm-variable">im</span>.<span class="cm-property">height</span>, <span class="cm-variable">n</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable">x</span>,<span class="cm-variable">y</span>) <span class="cm-keyword">in</span> <span class="cm-builtin">zip</span>(<span class="cm-variable">x</span>,<span class="cm-variable">y</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">im</span>.<span class="cm-property">putpixel</span>((<span class="cm-variable">x</span>, <span class="cm-variable">y</span>), ((<span class="cm-number">0</span>,<span class="cm-number">0</span>,<span class="cm-number">0</span>) <span class="cm-keyword">if</span> <span class="cm-variable">np</span>.<span class="cm-property">random</span>.<span class="cm-property">rand</span>() <span class="cm-operator">&lt;</span> <span class="cm-number">0.5</span> <span class="cm-keyword">else</span> (<span class="cm-number">255</span>,<span class="cm-number">255</span>,<span class="cm-number">255</span>))) <span class="cm-comment"># generate salt-and-pepper noise</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">im</span>.<span class="cm-property">save</span>(<span class="cm-string">'../images/mandrill_spnoise_'</span> <span class="cm-operator">+</span> <span class="cm-builtin">str</span>(<span class="cm-variable">prop_noise</span>) <span class="cm-operator">+</span> <span class="cm-string">'.jpg'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">pylab</span>.<span class="cm-property">subplot</span>(<span class="cm-number">6</span>,<span class="cm-number">2</span>,<span class="cm-variable">i</span>), <span class="cm-variable">plot_image</span>(<span class="cm-variable">im</span>, <span class="cm-string">'Original Image with '</span> <span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-builtin">str</span>(<span class="cm-builtin">int</span>(<span class="cm-number">100</span><span class="cm-operator">*</span><span class="cm-variable">prop_noise</span>)) <span class="cm-operator">+</span> <span class="cm-string">'% added noise'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">i</span> += <span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">im1</span> = <span class="cm-variable">im</span>.<span class="cm-property">filter</span>(<span class="cm-variable">ImageFilter</span>.<span class="cm-property">BLUR</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">pylab</span>.<span class="cm-property">subplot</span>(<span class="cm-number">6</span>,<span class="cm-number">2</span>,<span class="cm-variable">i</span>), <span class="cm-variable">plot_image</span>(<span class="cm-variable">im1</span>, <span class="cm-string">'Blurred Image'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">i</span> += <span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">show</span>()</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 414px;"></div><div class="CodeMirror-gutters" style="display: none; height: 414px;"></div></div></div></pre><p><img src="img/Chapter4/output_45_0.png" referrerpolicy="no-referrer" alt="png"></p><p><span>The screenshot shows the output. The smoothed image quality gets poorer as the input image gets noisier, as expected.</span></p><h4 id='smoothing-by-averaging-with-the-box-blur-kernel'><span>Smoothing by averaging with the box blur kernel</span></h4><p><span>The following code block shows how to use the PIL ImageFilter.Kernel() function and box blur kernels (mean filters) of a size of 3 x 3 and 5 x 5 to smooth a noisy image</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">im</span> = <span class="cm-variable">Image</span>.<span class="cm-property">open</span>(<span class="cm-string">'../images/mandrill_spnoise_0.1.jpg'</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">figure</span>(<span class="cm-variable">figsize</span>=(<span class="cm-number">20</span>,<span class="cm-number">7</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">subplot</span>(<span class="cm-number">1</span>,<span class="cm-number">3</span>,<span class="cm-number">1</span>), <span class="cm-variable">pylab</span>.<span class="cm-property">imshow</span>(<span class="cm-variable">im</span>), <span class="cm-variable">pylab</span>.<span class="cm-property">title</span>(<span class="cm-string">'Original Image'</span>, <span class="cm-variable">size</span>=<span class="cm-number">30</span>), <span class="cm-variable">pylab</span>.<span class="cm-property">axis</span>(<span class="cm-string">'off'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for</span> <span class="cm-variable">n</span> <span class="cm-keyword">in</span> [<span class="cm-number">3</span>,<span class="cm-number">5</span>]:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">box_blur_kernel</span> = <span class="cm-variable">np</span>.<span class="cm-property">reshape</span>(<span class="cm-variable">np</span>.<span class="cm-property">ones</span>(<span class="cm-variable">n</span><span class="cm-operator">*</span><span class="cm-variable">n</span>),(<span class="cm-variable">n</span>,<span class="cm-variable">n</span>)) <span class="cm-operator">/</span> (<span class="cm-variable">n</span><span class="cm-operator">*</span><span class="cm-variable">n</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">im1</span> = <span class="cm-variable">im</span>.<span class="cm-property">filter</span>(<span class="cm-variable">ImageFilter</span>.<span class="cm-property">Kernel</span>((<span class="cm-variable">n</span>,<span class="cm-variable">n</span>), <span class="cm-variable">box_blur_kernel</span>.<span class="cm-property">flatten</span>()))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">pylab</span>.<span class="cm-property">subplot</span>(<span class="cm-number">1</span>,<span class="cm-number">3</span>,(<span class="cm-number">2</span> <span class="cm-keyword">if</span> <span class="cm-variable">n</span>==<span class="cm-number">3</span> <span class="cm-keyword">else</span> <span class="cm-number">3</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">plot_image</span>(<span class="cm-variable">im1</span>, <span class="cm-string">'Blurred with kernel size = '</span> <span class="cm-operator">+</span> <span class="cm-builtin">str</span>(<span class="cm-variable">n</span>) <span class="cm-operator">+</span> <span class="cm-string">'x'</span> <span class="cm-operator">+</span> <span class="cm-builtin">str</span>(<span class="cm-variable">n</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">suptitle</span>(<span class="cm-string">'PIL Mean Filter (Box Blur) with different Kernel size'</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">size</span>=<span class="cm-number">30</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">show</span>()</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 276px;"></div><div class="CodeMirror-gutters" style="display: none; height: 276px;"></div></div></div></pre><p><img src="img/Chapter4/output_49_0.png" referrerpolicy="no-referrer" alt="png"></p><p>&nbsp;</p><h4 id='smoothing-with-the-gaussian-blur-filter'><span>Smoothing with the Gaussian blur filter</span></h4><p><span>The Gaussian blur filter is also a linear filter but, unlike the simple mean filter, it takes the weighted average of the pixels inside the kernel window to smooth a pixel (the weight corresponding to a neighbor pixel decreases exponentially with the distance of the neighbor from the pixel). The following code shows how the PIL ImageFilter.GaussianBlur() can be used to smooth a noisier image with different radius parameter values for the kernel:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">im</span> = <span class="cm-variable">Image</span>.<span class="cm-property">open</span>(<span class="cm-string">'../images/mandrill_spnoise_0.2.jpg'</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">figure</span>(<span class="cm-variable">figsize</span>=(<span class="cm-number">20</span>,<span class="cm-number">6</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">i</span> = <span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for</span> <span class="cm-variable">radius</span> <span class="cm-keyword">in</span> <span class="cm-builtin">range</span>(<span class="cm-number">1</span>, <span class="cm-number">4</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">im1</span> = <span class="cm-variable">im</span>.<span class="cm-property">filter</span>(<span class="cm-variable">ImageFilter</span>.<span class="cm-property">GaussianBlur</span>(<span class="cm-variable">radius</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">pylab</span>.<span class="cm-property">subplot</span>(<span class="cm-number">1</span>,<span class="cm-number">3</span>,<span class="cm-variable">i</span>), <span class="cm-variable">plot_image</span>(<span class="cm-variable">im1</span>, <span class="cm-string">'radius = '</span> <span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-builtin">str</span>(<span class="cm-builtin">round</span>(<span class="cm-variable">radius</span>,<span class="cm-number">2</span>)))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">i</span> += <span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">suptitle</span>(<span class="cm-string">'PIL Gaussian Blur with different Radius'</span>, <span class="cm-variable">size</span>=<span class="cm-number">20</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">show</span>()</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 230px;"></div><div class="CodeMirror-gutters" style="display: none; height: 230px;"></div></div></div></pre><p><img src="img/Chapter4/output_51_0.png" referrerpolicy="no-referrer" alt="png"></p><p>&nbsp;</p><p><span>The screenshot shows the output. As can be seen, with a higher radius with the Gaussian filter, the image becomes smoother with the removal of more and more noise, while at the same time blurring the image more:</span></p><h4 id='comparing-smoothing-with-box-and-gaussian-kernels-using-scipy-ndimage'><span>Comparing smoothing with box and Gaussian kernels using SciPy ndimage</span></h4><p><span>We can apply a linear filter to smooth images using SciPy&#39;s ndimage module functions too. The following code snippet shows a demonstration of the results of applying the linear filters on the mandrill image degraded with impulse (salt-and-pepper) noise:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">scipy</span> <span class="cm-keyword">import</span> <span class="cm-variable">misc</span>, <span class="cm-variable">ndimage</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">matplotlib</span>.<span class="cm-property">pylab</span> <span class="cm-keyword">as</span> <span class="cm-variable">pylab</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">im</span> = <span class="cm-variable">misc</span>.<span class="cm-property">imread</span>(<span class="cm-string">'../images/mandrill_spnoise_0.1.jpg'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">k</span> = <span class="cm-number">7</span> <span class="cm-comment"># 7x7 kernel</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">im_box</span> = <span class="cm-variable">ndimage</span>.<span class="cm-property">uniform_filter</span>(<span class="cm-variable">im</span>, <span class="cm-variable">size</span>=(<span class="cm-variable">k</span>,<span class="cm-variable">k</span>,<span class="cm-number">1</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">s</span> = <span class="cm-number">2</span> <span class="cm-comment"># sigma value</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">t</span> = (((<span class="cm-variable">k</span> <span class="cm-operator">-</span> <span class="cm-number">1</span>)<span class="cm-operator">/</span><span class="cm-number">2</span>)<span class="cm-operator">-</span><span class="cm-number">0.5</span>)<span class="cm-operator">/</span><span class="cm-variable">s</span> <span class="cm-comment"># truncate parameter value for a kxk gaussian kernel with sigma s</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">im_gaussian</span> = <span class="cm-variable">ndimage</span>.<span class="cm-property">gaussian_filter</span>(<span class="cm-variable">im</span>, <span class="cm-variable">sigma</span>=(<span class="cm-variable">s</span>,<span class="cm-variable">s</span>,<span class="cm-number">0</span>), <span class="cm-variable">truncate</span>=<span class="cm-variable">t</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">fig</span> = <span class="cm-variable">pylab</span>.<span class="cm-property">figure</span>(<span class="cm-variable">figsize</span>=(<span class="cm-number">30</span>,<span class="cm-number">10</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">subplot</span>(<span class="cm-number">131</span>), <span class="cm-variable">plot_image</span>(<span class="cm-variable">im</span>, <span class="cm-string">'original image'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">subplot</span>(<span class="cm-number">132</span>), <span class="cm-variable">plot_image</span>(<span class="cm-variable">im_box</span>, <span class="cm-string">'with the box filter'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">subplot</span>(<span class="cm-number">133</span>), <span class="cm-variable">plot_image</span>(<span class="cm-variable">im_gaussian</span>, <span class="cm-string">'with the gaussian filter'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">show</span>()</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 322px;"></div><div class="CodeMirror-gutters" style="display: none; height: 322px;"></div></div></div></pre><p><img src="img/Chapter4/output_54_0.png" referrerpolicy="no-referrer" alt="png"></p><p>&nbsp;</p><p><span>The screenshot shows the output of the previous code. As can be seen, the box filter of the same kernel size blurs the output image more than the Gaussian filter of same size with σ=2.</span></p><h3 id='nonlinear-noise-smoothing'><span>Nonlinear noise smoothing</span></h3><p><span>Nonlinear (spatial) filters also operate on neighborhoods and are implemented by sliding a kernel (mask) over an image like a linear filter. However, the filtering operation is based conditionally on the values of the pixels in the neighborhood, and they do not explicitly use coefficients in the sum-of-products manner in general. For example, noise reduction can be effectively done with a non-linear filter whose basic function is to compute the median gray-level value in the neighborhood where the filter is located. This filter is a nonlinear filter, since the median computation is a non-linear operation. Median filters are quite popular since, for certain types of random noise (for example, impulse noise), they provide excellent noise-reduction capabilities, with considerably less blurring than linear smoothing filters of similar size. Non-linear filters are more powerful than linear filters; for example, in terms of suppression of non-Gaussian noise such as spikes and for edge/texture preserving properties. Some examples of non-linear filters are median, bilateral, non-local means, and morphological filters. The following sections demonstrate the implementation of a few non-linear filters with PIL, </span><em><strong><span>scikit-image</span></strong></em><span>, and </span><em><strong><span>scipy ndimage</span></strong></em><span> library functions.</span></p><h3 id='smoothing-with-pil-2'><span>Smoothing with PIL</span></h3><p><span>The PIL </span><em><strong><span>ImageFilter</span></strong></em><span> module provides a set of functions for non-linear denoising of an image. In this section, we shall demonstrate some of them with examples.</span></p><h4 id='using-the-median-filter'><span>Using the median filter</span></h4><p><span>The median filter replaces each pixel with the median of the values of its neighbor pixels. This filter is great for removing of salt-and-pepper noise, although it removes small details from the image. We need to give first rank to the neighborhood intensities and then select the middle value. Median filtering is resilient to statistical outliers, incurs less blurring, and is simple to implement. The following code block shows how the PIL </span><em><strong><span>ImageFilter</span></strong></em><span> module&#39;s </span><em><strong><span>MedianFilter()</span></strong></em><span> function can be used to remove salt-and-pepper noise from the noisy mandrill image, with different levels of noise added and a different size of the kernel window used for the median filter:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">i</span> = <span class="cm-number">1</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">figure</span>(<span class="cm-variable">figsize</span>=(<span class="cm-number">25</span>,<span class="cm-number">35</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for</span> <span class="cm-variable">prop_noise</span> <span class="cm-keyword">in</span> <span class="cm-variable">np</span>.<span class="cm-property">linspace</span>(<span class="cm-number">0.05</span>,<span class="cm-number">0.3</span>,<span class="cm-number">3</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">im</span> = <span class="cm-variable">Image</span>.<span class="cm-property">open</span>(<span class="cm-string">'../images/mandrill.jpg'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment"># choose 5000 random locations inside image</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">n</span> = <span class="cm-builtin">int</span>(<span class="cm-variable">im</span>.<span class="cm-property">width</span> <span class="cm-operator">*</span> <span class="cm-variable">im</span>.<span class="cm-property">height</span> <span class="cm-operator">*</span> <span class="cm-variable">prop_noise</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">x</span>, <span class="cm-variable">y</span> = <span class="cm-variable">np</span>.<span class="cm-property">random</span>.<span class="cm-property">randint</span>(<span class="cm-number">0</span>, <span class="cm-variable">im</span>.<span class="cm-property">width</span>, <span class="cm-variable">n</span>), <span class="cm-variable">np</span>.<span class="cm-property">random</span>.<span class="cm-property">randint</span>(<span class="cm-number">0</span>, <span class="cm-variable">im</span>.<span class="cm-property">height</span>, <span class="cm-variable">n</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable">x</span>,<span class="cm-variable">y</span>) <span class="cm-keyword">in</span> <span class="cm-builtin">zip</span>(<span class="cm-variable">x</span>,<span class="cm-variable">y</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">im</span>.<span class="cm-property">putpixel</span>((<span class="cm-variable">x</span>, <span class="cm-variable">y</span>), ((<span class="cm-number">0</span>,<span class="cm-number">0</span>,<span class="cm-number">0</span>) <span class="cm-keyword">if</span> <span class="cm-variable">np</span>.<span class="cm-property">random</span>.<span class="cm-property">rand</span>() <span class="cm-operator">&lt;</span> <span class="cm-number">0.5</span> <span class="cm-keyword">else</span> (<span class="cm-number">255</span>,<span class="cm-number">255</span>,<span class="cm-number">255</span>))) <span class="cm-comment"># geenrate salt-and-pepper noise</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">im</span>.<span class="cm-property">save</span>(<span class="cm-string">'../images/mandrill_spnoise_'</span> <span class="cm-operator">+</span> <span class="cm-builtin">str</span>(<span class="cm-variable">prop_noise</span>) <span class="cm-operator">+</span> <span class="cm-string">'.jpg'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">pylab</span>.<span class="cm-property">subplot</span>(<span class="cm-number">6</span>,<span class="cm-number">4</span>,<span class="cm-variable">i</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">plot_image</span>(<span class="cm-variable">im</span>, <span class="cm-string">'Original Image with '</span> <span class="cm-operator">+</span> <span class="cm-builtin">str</span>(<span class="cm-builtin">int</span>(<span class="cm-number">100</span><span class="cm-operator">*</span><span class="cm-variable">prop_noise</span>)) <span class="cm-operator">+</span> <span class="cm-string">'%added noise'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">i</span> += <span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">for</span> <span class="cm-variable">sz</span> <span class="cm-keyword">in</span> [<span class="cm-number">3</span>,<span class="cm-number">7</span>,<span class="cm-number">11</span>]:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">im1</span> = <span class="cm-variable">im</span>.<span class="cm-property">filter</span>(<span class="cm-variable">ImageFilter</span>.<span class="cm-property">MedianFilter</span>(<span class="cm-variable">size</span>=<span class="cm-variable">sz</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">pylab</span>.<span class="cm-property">subplot</span>(<span class="cm-number">6</span>,<span class="cm-number">4</span>,<span class="cm-variable">i</span>), <span class="cm-variable">plot_image</span>(<span class="cm-variable">im1</span>, <span class="cm-string">'Output (Median Filter size='</span> <span class="cm-operator">+</span> &nbsp;<span class="cm-builtin">str</span>(<span class="cm-variable">sz</span>) <span class="cm-operator">+</span> <span class="cm-string">')'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">i</span> += <span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">show</span>()</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 483px;"></div><div class="CodeMirror-gutters" style="display: none; height: 483px;"></div></div></div></pre><p><img src="img/Chapter4/output_59_0.png" referrerpolicy="no-referrer" alt="png"></p><p>&nbsp;</p><p><span>The screenshot shows the output of the previous code, the output images after applying the median filter on the noisy images with different levels of added noise with a different kernel size. As can be seen, the results show that the non-linear median filter works much better for impulse (salt-and-pepper) noise than the linear mean and weighted mean (Gaussian) filters, although with some patchy effects and the loss of some details.</span></p><h4 id='using-max-and-min-filter'><span>Using max and min filter</span></h4><p><span>The following code shows how to use the MaxFilter()to remove the pepper noise followed by a MinFilter() to remove the salt noise from an image.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">im</span> = <span class="cm-variable">Image</span>.<span class="cm-property">open</span>(<span class="cm-string">'../images/mandrill_spnoise_0.1.jpg'</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">figure</span>(<span class="cm-variable">figsize</span>=(<span class="cm-number">30</span>,<span class="cm-number">10</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">sz</span> = <span class="cm-number">3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">subplot</span>(<span class="cm-number">1</span>,<span class="cm-number">3</span>,<span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plot_image</span>(<span class="cm-variable">im</span>, <span class="cm-string">'Original Image with 10% added noise'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">im1</span> = <span class="cm-variable">im</span>.<span class="cm-property">filter</span>(<span class="cm-variable">ImageFilter</span>.<span class="cm-property">MaxFilter</span>(<span class="cm-variable">size</span>=<span class="cm-variable">sz</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">subplot</span>(<span class="cm-number">1</span>,<span class="cm-number">3</span>,<span class="cm-number">2</span>), <span class="cm-variable">plot_image</span>(<span class="cm-variable">im1</span>, <span class="cm-string">'Output (Max Filter size='</span> <span class="cm-operator">+</span> <span class="cm-builtin">str</span>(<span class="cm-variable">sz</span>)<span class="cm-operator">+</span> <span class="cm-string">')'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">im1</span> = <span class="cm-variable">im1</span>.<span class="cm-property">filter</span>(<span class="cm-variable">ImageFilter</span>.<span class="cm-property">MinFilter</span>(<span class="cm-variable">size</span>=<span class="cm-variable">sz</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">subplot</span>(<span class="cm-number">1</span>,<span class="cm-number">3</span>,<span class="cm-number">3</span>), <span class="cm-variable">plot_image</span>(<span class="cm-variable">im1</span>, <span class="cm-string">'Output (Min Filter size='</span> <span class="cm-operator">+</span> <span class="cm-builtin">str</span>(<span class="cm-variable">sz</span>)<span class="cm-operator">+</span> <span class="cm-string">')'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">show</span>()</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 230px;"></div><div class="CodeMirror-gutters" style="display: none; height: 230px;"></div></div></div></pre><p><img src="img/Chapter4/output_62_0.png" referrerpolicy="no-referrer" alt="png"></p><p>&nbsp;</p><h3 id='smoothing-denoising-with-scikit-image'><span>Smoothing (denoising) with scikit-image</span></h3><p><span>The </span><em><strong><span>scikit-image</span></strong></em><span> library also provides a set of non-linear filters in the </span><strong><span>restoration</span></strong><span> module. In the following sections, we will discuss about a couple of such very useful filters, namely </span><strong><span>bilateral</span></strong><span> and </span><strong><span>non-local</span></strong><span> means filters.</span></p><h4 id='using-the-bilateral-filter'><span>Using the bilateral filter</span></h4><p><span>The bilateral filter is an edge-preserving smoothing filter. For this filter, the center pixel is set to the weighted average of the pixel values of some of its neighbors </span><strong><span>only the ones with roughly similar brightness as the center pixel</span></strong><span>. In this section, we shall see how we can use scikit-image package&#39;s bilateral filter implementation to denoise an image. Let us first start by creating a noisy image from the following gray scale mountain image:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">im</span> = <span class="cm-variable">Image</span>.<span class="cm-property">open</span>(<span class="cm-string">'../images/mountain.png'</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">imshow</span>(<span class="cm-variable">im</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">axis</span>(<span class="cm-string">"off"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">show</span>()</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 92px;"></div><div class="CodeMirror-gutters" style="display: none; height: 92px;"></div></div></div></pre><p><img src="img/Chapter4/output_65_0.png" referrerpolicy="no-referrer" alt="png"></p><p><span>The following code block demonstrates how to use the numpy random_noise()function:   </span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">im</span> = <span class="cm-variable">color</span>.<span class="cm-property">rgb2gray</span>(<span class="cm-variable">img_as_float</span>(<span class="cm-variable">io</span>.<span class="cm-property">imread</span>(<span class="cm-string">'../images/mountain.png'</span>)))</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">axis</span>(<span class="cm-string">"off"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">imshow</span>(<span class="cm-variable">im</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">show</span>()</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 92px;"></div><div class="CodeMirror-gutters" style="display: none; height: 92px;"></div></div></div></pre><p><img src="img/Chapter4/output_67_0.png" referrerpolicy="no-referrer" alt="png"></p><p>&nbsp;</p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">sigma</span> = <span class="cm-number">0.155</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">noisy</span> = <span class="cm-variable">random_noise</span>(<span class="cm-variable">im</span>, <span class="cm-variable">var</span>=<span class="cm-variable">sigma</span><span class="cm-operator">**</span><span class="cm-number">2</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">imshow</span>(<span class="cm-variable">noisy</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">axis</span>(<span class="cm-string">"off"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">show</span>()</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 115px;"></div><div class="CodeMirror-gutters" style="display: none; height: 115px;"></div></div></div></pre><p><img src="img/Chapter4/output_68_0.png" referrerpolicy="no-referrer" alt="png"></p><p>&nbsp;</p><p><span>The following code block demonstrates how to use the bilateral filter to denoise the previous noisy image, with different values for the parameters, </span><strong><span>σcolor</span></strong><span> and </span><strong><span>σspatial</span></strong><span>:</span></p><p>&nbsp;</p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">figure</span>(<span class="cm-variable">figsize</span>=(<span class="cm-number">20</span>,<span class="cm-number">15</span>))</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">i</span> = <span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for</span> <span class="cm-variable">sigma_sp</span> <span class="cm-keyword">in</span> [<span class="cm-number">5</span>, <span class="cm-number">10</span>, <span class="cm-number">20</span>]:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">for</span> <span class="cm-variable">sigma_col</span> <span class="cm-keyword">in</span> [<span class="cm-number">0.1</span>, <span class="cm-number">0.25</span>, <span class="cm-number">5</span>]:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">pylab</span>.<span class="cm-property">subplot</span>(<span class="cm-number">3</span>,<span class="cm-number">3</span>,<span class="cm-variable">i</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">pylab</span>.<span class="cm-property">imshow</span>(<span class="cm-variable">denoise_bilateral</span>(<span class="cm-variable">noisy</span>, <span class="cm-variable">sigma_color</span>=<span class="cm-variable">sigma_col</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">sigma_spatial</span>=<span class="cm-variable">sigma_sp</span>, <span class="cm-variable">multichannel</span>=<span class="cm-keyword">False</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">pylab</span>.<span class="cm-property">title</span>(<span class="cm-string">r'$\sigma_r=$'</span> <span class="cm-operator">+</span> <span class="cm-builtin">str</span>(<span class="cm-variable">sigma_col</span>) <span class="cm-operator">+</span> <span class="cm-string">r', $\sigma_s=$'</span> <span class="cm-operator">+</span> <span class="cm-builtin">str</span>(<span class="cm-variable">sigma_sp</span>), <span class="cm-variable">size</span>=<span class="cm-number">20</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">i</span> += <span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">axis</span>(<span class="cm-string">"off"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">show</span>()</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 276px;"></div><div class="CodeMirror-gutters" style="display: none; height: 276px;"></div></div></div></pre><p><img src="img/Chapter4/output_70_0.png" referrerpolicy="no-referrer" alt="png"></p><p><span>The screenshot shows the output of the previous code. As can be seen, if the standard deviation is higher, the image gets less noisy but more blurred. It takes a few minutes to execute the previous code block, as the implementation is even slower on RGB images.</span></p><h4 id='using-non-local-means'><span>Using non-local means</span></h4><p><span>Non-local means is a non-linear denoising algorithm that </span><strong><span>preserves textures</span></strong><span>. In this algorithm, for any given pixel, a weighted average of values of only those nearby pixels that have similar local neighbors as the pixel of interest are used to set the value of the given pixel. In other words, small patches centered on the other pixels are compared to the patch centered on the pixel of interest. In this section, we demonstrate the algorithm by denoising a noisy parrot image using the non-local means filter. The </span><em><strong><span>h</span></strong></em><span> parameter to the function controls the decay in patch weights as a function of the distance between patches. If </span><em><strong><span>h</span></strong></em><span> is large, it allows more smoothing between dissimilar patches. The following code block shows how to denoise with non-local means:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">def</span> <span class="cm-def">plot_image_axes</span>(<span class="cm-variable">image</span>, <span class="cm-variable">axes</span>, <span class="cm-variable">title</span>):</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">axes</span>.<span class="cm-property">imshow</span>(<span class="cm-variable">image</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">axes</span>.<span class="cm-property">axis</span>(<span class="cm-string">'off'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">axes</span>.<span class="cm-property">set_title</span>(<span class="cm-variable">title</span>, <span class="cm-variable">size</span>=<span class="cm-number">20</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">parrot</span> = <span class="cm-variable">img_as_float</span>(<span class="cm-variable">imread</span>(<span class="cm-string">'../images/parrot.png'</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">sigma</span> = <span class="cm-number">0.25</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">noisy</span> = <span class="cm-variable">parrot</span> <span class="cm-operator">+</span> <span class="cm-variable">sigma</span> <span class="cm-operator">*</span> <span class="cm-variable">np</span>.<span class="cm-property">random</span>.<span class="cm-property">standard_normal</span>(<span class="cm-variable">parrot</span>.<span class="cm-property">shape</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">noisy</span> = <span class="cm-variable">np</span>.<span class="cm-property">clip</span>(<span class="cm-variable">noisy</span>, <span class="cm-number">0</span>, <span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># estimate the noise standard deviation from the noisy image</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">sigma_est</span> = <span class="cm-variable">np</span>.<span class="cm-property">mean</span>(<span class="cm-variable">estimate_sigma</span>(<span class="cm-variable">noisy</span>, <span class="cm-variable">multichannel</span>=<span class="cm-keyword">True</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"estimated noise standard deviation = {}"</span>.<span class="cm-property">format</span>(<span class="cm-variable">sigma_est</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># estimated noise standard deviation = 0.22048519002358943</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">patch_kw</span> = <span class="cm-builtin">dict</span>(<span class="cm-variable">patch_size</span>=<span class="cm-number">5</span>, <span class="cm-comment"># 5x5 patches</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">patch_distance</span>=<span class="cm-number">6</span>, <span class="cm-comment"># 13x13 search area</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">multichannel</span>=<span class="cm-keyword">True</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># slow algorithm</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">denoise</span> = <span class="cm-variable">denoise_nl_means</span>(<span class="cm-variable">noisy</span>, <span class="cm-variable">h</span>=<span class="cm-number">1.15</span> <span class="cm-operator">*</span> <span class="cm-variable">sigma_est</span>, <span class="cm-variable">fast_mode</span>=<span class="cm-keyword">False</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">**</span><span class="cm-variable">patch_kw</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># fast algorithm</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">denoise_fast</span> = <span class="cm-variable">denoise_nl_means</span>(<span class="cm-variable">noisy</span>, <span class="cm-variable">h</span>=<span class="cm-number">0.8</span> <span class="cm-operator">*</span> <span class="cm-variable">sigma_est</span>, <span class="cm-variable">fast_mode</span>=<span class="cm-keyword">True</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">**</span><span class="cm-variable">patch_kw</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">fig</span>, <span class="cm-variable">axes</span> = <span class="cm-variable">pylab</span>.<span class="cm-property">subplots</span>(<span class="cm-variable">nrows</span>=<span class="cm-number">2</span>, <span class="cm-variable">ncols</span>=<span class="cm-number">2</span>, <span class="cm-variable">figsize</span>=(<span class="cm-number">15</span>, <span class="cm-number">12</span>), <span class="cm-variable">sharex</span>=<span class="cm-keyword">True</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">sharey</span>=<span class="cm-keyword">True</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plot_image_axes</span>(<span class="cm-variable">noisy</span>, <span class="cm-variable">axes</span>[<span class="cm-number">0</span>, <span class="cm-number">0</span>], <span class="cm-string">'noisy'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plot_image_axes</span>(<span class="cm-variable">denoise</span>, <span class="cm-variable">axes</span>[<span class="cm-number">0</span>, <span class="cm-number">1</span>], <span class="cm-string">'non-local means\n(slow)'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plot_image_axes</span>(<span class="cm-variable">parrot</span>, <span class="cm-variable">axes</span>[<span class="cm-number">1</span>, <span class="cm-number">0</span>], <span class="cm-string">'original\n(noise free)'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plot_image_axes</span>(<span class="cm-variable">denoise_fast</span>, <span class="cm-variable">axes</span>[<span class="cm-number">1</span>, <span class="cm-number">1</span>], <span class="cm-string">'non-local means\n(fast)'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">fig</span>.<span class="cm-property">tight_layout</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># PSNR metric values</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">psnr_noisy</span> = <span class="cm-variable">compare_psnr</span>(<span class="cm-variable">parrot</span>, <span class="cm-variable">noisy</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">psnr</span> = <span class="cm-variable">compare_psnr</span>(<span class="cm-variable">parrot</span>, <span class="cm-variable">denoise</span>.<span class="cm-property">astype</span>(<span class="cm-variable">np</span>.<span class="cm-property">float64</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">psnr_fast</span> = <span class="cm-variable">compare_psnr</span>(<span class="cm-variable">parrot</span>, <span class="cm-variable">denoise_fast</span>.<span class="cm-property">astype</span>(<span class="cm-variable">np</span>.<span class="cm-property">float64</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"PSNR (noisy) = {:0.2f}"</span>.<span class="cm-property">format</span>(<span class="cm-variable">psnr_noisy</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"PSNR (slow) = {:0.2f}"</span>.<span class="cm-property">format</span>(<span class="cm-variable">psnr</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">"PSNR (fast) = {:0.2f}"</span>.<span class="cm-property">format</span>(<span class="cm-variable">psnr_fast</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># PSNR (noisy) = 13.04 # PSNR (slow) = 26.25 # PSNR (fast) = 25.84</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">show</span>()</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 874px;"></div><div class="CodeMirror-gutters" style="display: none; height: 874px;"></div></div></div></pre><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">estimated noise standard deviation = 0.21940489059491528</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">PSNR (noisy) = 13.04</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">PSNR (slow) = 25.93</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">PSNR (fast) = 25.52</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 92px;"></div><div class="CodeMirror-gutters" style="display: none; height: 92px;"></div></div></div></pre><p>&nbsp;</p><p><img src="img/Chapter4/output_73_1.png" referrerpolicy="no-referrer" alt="png"></p><p><span>The got screenshot shows the output. As can be seen, the slow version of the algorithm achieves better PSNR than the faster version, representing a trade-off. Both of the algorithm output images have much higher PSNR than the noisy image.</span></p><h3 id='smoothing-with-scipy-ndimage'><span>Smoothing with scipy ndimage</span></h3><p><span>The scipy </span><em><strong><span>ndimage</span></strong></em><span> module provides a function named percentile_filter(), which is a generic version of the median filter. The following code block demonstrates how to use this filter:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.5px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">lena</span> = <span class="cm-variable">misc</span>.<span class="cm-property">imread</span>(<span class="cm-string">'../images/lena.jpg'</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># add salt-and-pepper noise to the input image</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">noise</span> = <span class="cm-variable">np</span>.<span class="cm-property">random</span>.<span class="cm-property">random</span>(<span class="cm-variable">lena</span>.<span class="cm-property">shape</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">lena</span>[<span class="cm-variable">noise</span> <span class="cm-operator">&gt;</span> <span class="cm-number">0.9</span>] = <span class="cm-number">255</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">lena</span>[<span class="cm-variable">noise</span> <span class="cm-operator">&lt;</span> <span class="cm-number">0.1</span>] = <span class="cm-number">0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plot_image</span>(<span class="cm-variable">lena</span>, <span class="cm-string">'noisy image'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">show</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">fig</span> = <span class="cm-variable">pylab</span>.<span class="cm-property">figure</span>(<span class="cm-variable">figsize</span>=(<span class="cm-number">20</span>,<span class="cm-number">15</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">i</span> = <span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for</span> <span class="cm-variable">p</span> <span class="cm-keyword">in</span> <span class="cm-builtin">range</span>(<span class="cm-number">25</span>, <span class="cm-number">100</span>, <span class="cm-number">25</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">for</span> <span class="cm-variable">k</span> <span class="cm-keyword">in</span> <span class="cm-builtin">range</span>(<span class="cm-number">5</span>, <span class="cm-number">25</span>, <span class="cm-number">5</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">pylab</span>.<span class="cm-property">subplot</span>(<span class="cm-number">3</span>,<span class="cm-number">4</span>,<span class="cm-variable">i</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">filtered</span> = <span class="cm-variable">ndimage</span>.<span class="cm-property">percentile_filter</span>(<span class="cm-variable">lena</span>, <span class="cm-variable">percentile</span>=<span class="cm-variable">p</span>, <span class="cm-variable">size</span>=(<span class="cm-variable">k</span>,<span class="cm-variable">k</span>,<span class="cm-number">1</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">plot_image</span>(<span class="cm-variable">filtered</span>, <span class="cm-builtin">str</span>(<span class="cm-variable">p</span>) <span class="cm-operator">+</span> <span class="cm-string">' percentile, '</span> <span class="cm-operator">+</span> <span class="cm-builtin">str</span>(<span class="cm-variable">k</span>) <span class="cm-operator">+</span> <span class="cm-string">'x'</span> <span class="cm-operator">+</span> <span class="cm-builtin">str</span>(<span class="cm-variable">k</span>) <span class="cm-operator">+</span> <span class="cm-string">' kernel'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">i</span> += <span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pylab</span>.<span class="cm-property">show</span>()</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 391px;"></div><div class="CodeMirror-gutters" style="display: none; height: 391px;"></div></div></div></pre><p><img src="img/Chapter4/output_76_0.png" referrerpolicy="no-referrer" alt="png"></p><p>&nbsp;</p><p><img src="img/Chapter4/output_76_1.png" referrerpolicy="no-referrer" alt="png"></p><p><span>The gotten screenshot shows the output of the previous code. As can be seen, out of all of the percentile filters, the median filter (corresponding to the 50th percentile) with a small kernel size does the best to remove salt-and-pepper noise, while at the same time losing the fewest possible details in the image.</span></p><h3 id='summary'><span>Summary</span></h3><p><span>In this chapter, we discussed different image enhancement methods, starting from point transformations (for example, contrast stretching and thresholding), then techniques based on histogram processing (for example, histogram equalization and histogram matching), followed by image denoising techniques with linear (for example, mean and Gaussian) and non-linear (for example, median, bilateral, and non-local means) filters.By the end of this chapter, the reader should be able to write Python codes for point transformations (for example, negative, power-law transform, and contrast stretching), histogram-based image enhancements (for example, histogram equalization/matching), and image denoising (for example, mean/median filters).In the following chapter, we shall continue discussing more image enhancement techniques based on image derivatives and gradients.</span></p><h3 id='further-reading'><span>Further reading</span></h3><ul><li><a href='http://paulbourke.net/miscellaneous/equalisation/' target='_blank' class='url'>http://paulbourke.net/miscellaneous/equalisation/</a></li><li><a href='https://pdfs.semanticscholar.org/presentation/3fb7/fa0fca1bab83d523d882e98efa0f5769ec64.pdf' target='_blank' class='url'>https://pdfs.semanticscholar.org/presentation/3fb7/fa0fca1bab83d523d882e98efa0f5769ec64.pdf</a></li><li><a href='https://www.comp.nus.edu.sg/~cs4243/doc/SciPy%20reference.pdf' target='_blank' class='url'>https://www.comp.nus.edu.sg/~cs4243/doc/SciPy%20reference.pdf</a>
<a href='https://en.wikipedia.org/wiki/Floyd%E2%80%93Steinberg_dithering' target='_blank' class='url'>https://en.wikipedia.org/wiki/Floyd%E2%80%93Steinberg_dithering</a></li><li><a href='https://en.wikipedia.org/wiki/Floyd%E2%80%93Steinberg_dithering' target='_blank' class='url'>https://en.wikipedia.org/wiki/Floyd%E2%80%93Steinberg_dithering</a></li></ul></div></div>
</body>
</html>